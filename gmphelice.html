<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMP - H√âLICE</title>
    <style>
        :root {
            --primary: #1a3a5a;
            --accent: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 4px;
            font-size: 13px;
            line-height: 1.3;
        }

        .container {
            max-width: 100%;
            background: white;
            padding: 6px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
            margin: 0 auto;
        }

        .credits-integrated {
            position: absolute;
            top: 2px;
            right: 6px;
            background: var(--primary);
            color: white;
            padding: 1px 3px;
            font-size: 0.5rem;
            font-weight: bold;
            border-radius: 1px;
            z-index: 10;
        }

        /* CABE√áALHO SUPER COMPACTO */
        .header-mini {
            position: sticky;
            top: 0;
            background: white;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--primary);
            z-index: 5;
            margin-bottom: 6px;
            padding-top: 16px;
        }

        .header-mini-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .page-title-mini {
            margin: 0;
            color: var(--primary);
            font-size: 0.85rem;
            font-weight: bold;
            line-height: 1.1;
            max-width: 65%;
        }

        .timer-compact {
            background: #f8f9fa;
            color: var(--primary);
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 0.75rem;
            font-weight: bold;
            border: 1px solid #dee2e6;
            min-width: 40px;
            text-align: center;
        }

        .timer-warning {
            background: #fff5f5 !important;
            color: var(--danger) !important;
            border-color: var(--danger) !important;
        }

        /* INFO DO SIMULADO MAIS COMPACTA */
        .simulado-info {
            background: #e7f3ff;
            border: 1px solid var(--accent);
            border-radius: 3px;
            padding: 4px 5px;
            margin-bottom: 5px;
            font-size: 0.65rem;
            color: var(--primary);
            display: none;
        }

        .simulado-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 2px;
            font-weight: 600;
        }

        /* CONTROLES DE HIST√ìRICO COMPACTOS */
        .history-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-top: 4px;
        }

        .history-controls button {
            padding: 2px 4px;
            font-size: 0.6rem;
            border-radius: 2px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
        }

        .clear-history-btn {
            background: var(--warning);
            color: #856404;
            border: 1px solid #ffc107;
        }

        .info-history-btn {
            background: #6c757d;
            color: white;
        }

        /* INFO B√ÅSICA SUPER COMPACTA */
        .quiz-info-mini {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 5px 6px;
            border: 1px solid #dee2e6;
            margin-bottom: 4px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin-bottom: 4px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.55rem;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0;
        }

        .info-value {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* CONTROLES COMPACTOS */
        .controls-compact {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 4px;
        }

        .auto-nav-toggle {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 2px 4px;
            background: #e9ecef;
            border-radius: 2px;
            cursor: pointer;
            font-size: 0.65rem;
        }

        .auto-nav-checkbox {
            transform: scale(0.8);
            accent-color: var(--primary);
        }

        .auto-nav-label {
            font-weight: 600;
            color: var(--primary);
            white-space: nowrap;
        }

        .reset-btn-mini {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 2px 4px;
            font-size: 0.65rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }

        /* STATUS COMPACTO */
        .completion-status {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 4px 5px;
            margin: 5px 0;
            border: 1px solid #dee2e6;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
        }

        .status-text {
            font-size: 0.65rem;
            font-weight: 600;
        }

        .status-count {
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* PENDENTES SUPER COMPACTOS */
        .pending-compact {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 2px;
            padding: 2px 3px;
            font-size: 0.6rem;
        }

        .pending-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1px;
        }

        .pending-count {
            font-weight: bold;
            color: #856404;
            font-size: 0.65rem;
        }

        .pending-list-compact {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            max-height: 18px;
            overflow-y: auto;
            padding: 1px 0;
        }

        .pending-number {
            background: #ffc107;
            color: #856404;
            font-weight: bold;
            padding: 0 2px;
            border-radius: 1px;
            font-size: 0.55rem;
            min-width: 12px;
            text-align: center;
            line-height: 1.2;
        }

        .pending-number.answered {
            background: #28a745;
            color: white;
            opacity: 0.5;
        }

        /* QUEST√ïES COMPACTAS */
        .question-block-mini {
            margin: 6px 0;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            background: #fff;
        }

        .question-text-mini {
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 6px;
            color: var(--primary);
            line-height: 1.2;
        }

        .options-mini {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .option-mini {
            padding: 5px 6px;
            border: 1px solid #eee;
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.75rem;
            min-height: 28px;
        }

        input[type="radio"] {
            margin-right: 4px;
            transform: scale(0.8);
            accent-color: var(--primary);
        }

        .correct-answer {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724;
        }

        .wrong-answer {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24;
        }

        /* BOT√ïES DE NAVEGA√á√ÉO COMPACTOS */
        .nav-buttons {
            display: flex;
            gap: 4px;
            margin: 8px 0;
        }

        .nav-btn {
            flex: 1;
            padding: 6px 4px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 2px;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            text-align: center;
            min-height: 32px;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* BOT√ïES PRINCIPAIS COMPACTOS */
        .btn {
            padding: 8px;
            font-size: 0.8rem;
            font-weight: bold;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
            min-height: 36px;
        }

        .btn-finish {
            background: var(--primary);
            color: white;
        }

        .btn-finish:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-restart {
            background: var(--success);
            color: white;
            display: none;
        }

        /* RESULTADOS COMPACTOS */
        #results {
            display: none;
            padding: 10px;
            text-align: center;
            border: 1px solid var(--primary);
            margin: 8px 0;
            border-radius: 3px;
            background: #f8f9fa;
        }

        .result-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--primary);
        }

        .score-mini {
            font-size: 1.1rem;
            margin: 4px 0;
            font-weight: 800;
            color: var(--primary);
        }

        /* SCROLL PERSONALIZADO */
        .pending-list-compact::-webkit-scrollbar {
            height: 2px;
        }
        
        .pending-list-compact::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 1px;
        }
        
        .pending-list-compact::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 1px;
        }

        /* AJUSTES PARA TELAS MUITO PEQUENAS */
        @media (max-width: 320px) {
            body {
                padding: 2px;
                font-size: 12px;
            }
            
            .container {
                padding: 4px;
            }
            
            .page-title-mini {
                font-size: 0.75rem;
                max-width: 60%;
            }
            
            .timer-compact {
                font-size: 0.7rem;
                min-width: 35px;
                padding: 1px 3px;
            }
            
            .info-grid {
                gap: 3px;
            }
            
            .info-label {
                font-size: 0.5rem;
            }
            
            .info-value {
                font-size: 0.7rem;
            }
            
            .question-text-mini {
                font-size: 0.75rem;
            }
            
            .option-mini {
                padding: 4px 5px;
                font-size: 0.7rem;
                min-height: 26px;
            }
            
            .nav-btn, .btn {
                font-size: 0.7rem;
                padding: 5px 3px;
            }
            
            .pending-list-compact {
                max-height: 16px;
            }
            
            .pending-number {
                font-size: 0.5rem;
                min-width: 10px;
            }
        }

        @media (max-height: 600px) {
            .header-mini {
                padding-top: 10px;
            }
            
            .question-block-mini {
                margin: 4px 0;
                padding: 6px;
            }
            
            .nav-buttons {
                margin: 6px 0;
            }
            
            .btn {
                margin-top: 6px;
                min-height: 32px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="credits-integrated">BY EWERTON</div>
    
    <div class="header-mini">
        <div class="header-mini-top">
            <h1 class="page-title-mini" id="page-title">Carregando...</h1>
            <div id="timer" class="timer-compact">00:00</div>
        </div>
        
        <div class="simulado-info" id="simulado-info">
            <div>Simulado: <span id="questions-per-simulado">20</span> quest√µes</div>
            <div class="simulado-stats">
                <span id="remaining-questions">Dispon√≠veis: 0</span>
                <span id="recent-used">Usadas: 0</span>
            </div>
            
            <div class="history-controls">
                <button class="clear-history-btn" onclick="clearHistory()">
                    üóëÔ∏è Limpar Hist√≥rico
                </button>
                <button class="info-history-btn" onclick="showHistoryInfo()">
                    ‚ÑπÔ∏è Info
                </button>
            </div>
        </div>
        
        <div class="quiz-info-mini">
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Quest√£o</div>
                    <div class="info-value" id="question-counter">0/0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Respondidas</div>
                    <div class="info-value" id="answered-counter">0/0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Progresso</div>
                    <div class="info-value" id="progress-percent">0%</div>
                </div>
            </div>
            
            <div class="controls-compact">
                <div class="auto-nav-toggle" onclick="toggleAutoNav()">
                    <input type="checkbox" id="auto-nav-checkbox" class="auto-nav-checkbox" checked>
                    <label class="auto-nav-label">Auto-navega√ß√£o</label>
                </div>
                <button class="reset-btn-mini" onclick="resetQuiz()">
                    ‚Üª Reiniciar
                </button>
            </div>
        </div>

        <div class="completion-status">
            <div class="status-header">
                <span class="status-text">Status:</span>
                <span class="status-count" id="status-count">0/0</span>
            </div>
            <div class="pending-compact" id="pending-questions">
                <div class="pending-summary">
                    <span>Pendentes:</span>
                    <span class="pending-count" id="pending-count">0</span>
                </div>
                <div class="pending-list-compact" id="pending-list">
                    <span style="color: #6c757d; font-style: italic;">Nenhuma pendente</span>
                </div>
            </div>
        </div>
    </div>

    <div id="results">
        <div class="result-title" id="feedback-msg"></div>
        <div class="score-mini" id="final-score"></div>
        <div id="final-percent" style="font-size: 0.8rem; font-weight: bold; margin-bottom: 6px; color: var(--accent);"></div>
        <div id="simulado-summary" style="margin-bottom: 8px; font-size: 0.7rem; color: var(--primary);"></div>
        <button id="restart-btn" class="btn btn-restart" onclick="startNewQuiz()">üîÑ Refazer</button>
        <button id="new-simulado-btn" class="btn" style="background: var(--accent); color: white; margin-top: 4px; display: none;" onclick="generateNewSimulado()">üé≤ Novo Simulado</button>
    </div>

    <div id="quiz-content"></div>

    <div class="nav-buttons">
        <button id="prev-btn" class="nav-btn" onclick="prevQuestion()" disabled>
            ‚Üê Anterior
        </button>
        <button id="next-btn" class="nav-btn" onclick="nextQuestion()">
            Pr√≥ximo ‚Üí
        </button>
    </div>

    <button id="finish-btn" class="btn btn-finish" onclick="finalizeQuiz()" disabled>
        üèÅ Finalizar
    </button>
</div>

<script>
    
const masterBank = [

    {q: "Uma parada do motor em decorr√™ncia de colis√£o de uma ou mais p√°s de h√©lice com um objeto, de modo que o motor pare antes que a h√©lice complete uma volta, denomina-se:", a: ["retorno de chama", "cal√ßo hidr√°ulico", "parada brusca", "corte de motor"], c: 2},
    {q: "A dist√¢ncia que a h√©lice realmente percorre, denomina-se passo:", a: ["te√≥rico", "efetivo", "de recuo", "geom√©trico"], c: 1},
    {q: "A energia calorifica para o controle do degelo da p√° da h√©lice √© realizada atrav√©s de:", a: ["energia hidr√°ulica", "ar quente, oriundo do compressor", "ar quente, oriundo do escapamento", "energia el√©trica"], c: 3},
    {q: "A finalidade de se aplicar o passo reverso durante o pouso √©:", a: ["reduzir a corrida na pista, durante o pouso", "proporcionar maior controle do avi√£o no solo", "reduzir o tempo gasto para o t√°xi", "economizar combust√≠vel"], c: 0},
    {q: "A finalidade de se reduzir a velocidade de rota√ß√£o da h√©lice, em rela√ß√£o ao eixo de manivelas, √©:", a: ["economizar combust√≠vel", "manter a efici√™ncia da h√©lice", "reduzir a temperatura de trabalho do motor", "reduzir o esfor√ßo suportado pelas p√°s da h√©lice"], c: 1},
    {q: "A finalidade do conjunto do cubo da h√©lice √©:", a: ["aumentar a RPM", "manter o passo m√°ximo", "manter o passo m√≠nimo", "prender as p√°s no eixo de manivelas"], c: 3},
    {q: "A finalidade do governador da h√©lice de passo control√°vel √©:", a: ["regular o passo", "manter o √¢ngulo da p√° fixo", "reduzir a pot√™ncia do motor", "aumentar a pot√™ncia do motor"], c: 0},
    {q: "A finalidade do passo revers√≠vel na h√©lice √©:", a: ["aumentar a corrida na decolagem", "aumentar o volume de ar para o motor", "diminuir a corrida dos avi√µes durante a aterragem", "diminuir a velocidade da massa de ar no compressor"], c: 2},
    {q: "A finalidade do passo reverso da h√©lice √©:", a: ["reduzir o torque m√°ximo do motor", "reduzir, ao m√°ximo, a resist√™ncia ao avan√ßo", "produzir uma tra√ß√£o negativa, usando a pot√™ncia do motor", "produzir uma tra√ß√£o positiva, a fim de usar o freio o m√≠nimo necess√°rio"], c: 2},
    {q: "A finalidade do sistema de embandeiramento da h√©lice √©:", a: ["eliminar vibra√ß√µes do motor", "eliminar vibra√ß√µes da h√©lice", "compensar a perda de pot√™ncia do motor", "reduzir, ao m√≠nimo, a resist√™ncia ao avan√ßo"], c: 3},
    {q: "A finalidade do sistema de sincronismo das h√©lices, dentre outras, √©:", a: ["permitir que elas operem em passo m√≠nimo, em voo de cruzeiro", "reduzir a vibra√ß√£o", "evitar o torque negativo", "economizar combust√≠vel"], c: 1},
    {q: "A for√ßa f√≠sica que tende a expulsar as p√°s do cubo quando a h√©lice est√° em movimento denomina-se:", a: ["recuo", "tra√ß√£o", "centr√≠fuga", "aerodin√¢mica"], c: 2},
    {q: "A h√©lice √© fixada ao eixo do motor atrav√©s do componente denominado:", a: ["p√°", "cubo", "raiz", "c√∫pula"], c: 1},
    {q: "A h√©lice de velocidade constante, durante o voo tem:", a: ["passo fixo e RPM fixa", "passo vari√°vel e RPM fixa", "passo fixo e RPM vari√°vel", "passo vari√°vel e RPM vari√°vel"], c: 1},
    {q: "A h√©lice percorre uma dist√¢ncia denominada passo efetivo quando:", a: ["comandada para o passo m√≠nimo", "comandada para o passo m√°ximo", "realiza uma volta completa, considerando o recuo", "realiza uma volta, sem o recuo"], c: 2},
    {q: "A h√©lice que ajusta o passo, sem atua√ß√£o do operador, para manter constante a RPM do motor, denomina-se h√©lice:", a: ["ajust√°vel", "autom√°tica", "de passo constante", "de passo control√°vel"], c: 1},
    {q: "A mudan√ßa do √¢ngulo da p√° da h√©lice de passo fixo √© realizada:", a: ["na constru√ß√£o da h√©lice", "quando o motor estiver girando em alta rota√ß√£o", "quando a h√©lice estiver girando em baixa rota√ß√£o", "no momento em que o motor estiver em funcionamento"], c: 0},
    {q: "A parte de um motor convencional onde as engrenagens de redu√ß√£o da h√©lice est√£o localizadas denomina-se se√ß√£o:", a: ["do nariz", "das engrenagens dos acess√≥rios", "difusora", "de pot√™ncia"], c: 0},
    {q: "Ap√≥s uma parada brusca do motor, ocasionada pelo impacto de uma p√° da h√©lice com o solo, √© prov√°vel que ocorra desalinhamento no(a):", a: ["magneto", "filtro de √≥leo", "eixo de manivelas", "tubo de escapamento"], c: 2},
    {q: "Aumentando o √¢ngulo da p√° de uma h√©lice ocorrer√° o aumento do(a):", a: ["RPM", "passo", "rota√ß√£o", "pot√™ncia"], c: 1},
    {q: "√â a parte grossa e circular pr√≥xima da base, a qual √© designada a dar resist√™ncia √† p√°:", a: ["rotor", "flanco", "base", "raiz"], c: 3},
    {q: "Caso um dos motores de uma aeronave entre em pane, a h√©lice correspondente deve ser comandada para o passo:", a: ["bandeira", "reverso", "m√°ximo", "m√≠nimo"], c: 0},
    {q: "Com o al√≠vio da press√£o do √≥leo, atrav√©s do governador, os contrapesos e a mola levam as p√°s da h√©lice para o passo:", a: ["m√°ximo", "m√≠nimo", "reverso", "bandeira"], c: 0},
    {q: "Dentre as alternativas abaixo, aquela que pode causar altera√ß√£o aerodin√¢mica da p√° da h√©lice, quando em voo, √© o(a):", a: ["gelo", "calor", "ar frio", "vento de cauda"], c: 0},
    {q: "Dentre os tipos de h√©lices abaixo, aquela que √© empregada, tamb√©m, como freio aerodin√¢mico, denomina-se:", a: ["ajust√°vel", "revers√≠vel", "autom√°tica", "embandeir√°vel"], c: 1},
    {q: "Dist√¢ncia que uma h√©lice deveria avan√ßar em uma revolu√ß√£o:", a: ["√© a dist√¢ncia realmente percorrida por uma h√©lice", "dist√¢ncia que reconhece o recuo da h√©lice no ar", "chamado de passo te√≥rico ou geom√©trico", "todas est√£o corretas"], c: 2},
    {q: "Durante o giro do motor convencional de um avi√£o no solo se a p√° da h√©lice tocar num obst√°culo ocasionando parada brusca, deve-se:", a: ["substituir o motor", "trocar todo o √≥leo do motor", "remover o governador de h√©lice", "executar nova regulagem do governador de h√©lice"], c: 0},
    {q: "Em condi√ß√µes normais de voo a h√©lice varia entre o passo:", a: ["m√≠nimo e o passo m√°ximo", "m√≠nimo e o passo reverso", "m√°ximo e o passo reverso", "m√°ximo e o passo bandeira"], c: 0},
    {q: "Em uma h√©lice de velocidade constante, estando a h√©lice em movimento e ocorrendo forma√ß√£o de gelo nas p√°s, a distor√ß√£o do aerof√≥lio:", a: ["causar√° vibra√ß√£o", "causar√° redu√ß√£o de RPM", "mudar√° o passo para o reverso", "mudar√° o passo para o bandeira"], c: 0},
    {q: "Estando as p√°s da h√©lice na mesma dire√ß√£o do vento relativo, a h√©lice estar√° em passo:", a: ["m√≠nimo", "m√°ximo", "reverso", "bandeira"], c: 3},
    {q: "Na decolagem o √¢ngulo de uma h√©lice:", a: ["m√≠nimo", "m√°ximo", "bandeira", "45¬∞"], c: 0},
    {q: "Na decolagem, onde √© necess√°ria uma alta rota√ß√£o, a h√©lice dever√° estar no passo:", a: ["m√≠nimo", "m√°ximo", "bandeira", "reverso"], c: 0},
    {q: "Na h√©lice de passo control√°vel, a press√£o do √≥leo necess√°ria √† mudan√ßa do passo, √© fornecida pelo(a):", a: ["v√°lvula piloto", "bomba", "aranha", "contrapeso"], c: 1},
    {q: "No governador de uma h√©lice, a fun√ß√£o da v√°lvula piloto √©:", a: ["regular a quantidade de √≥leo", "controlar a press√£o da h√©lice", "regular a velocidade dos contrapesos", "diminuir a tens√£o da mola de velocidade"], c: 0},
    {q: "O √¢ngulo formado entre a corda da p√° e o plano de rota√ß√£o da h√©lice denomina-se √¢ngulo de(a):", a: ["p√°", "recuo", "ataque", "avan√ßo"], c: 2},
    {q: "O conjunto de h√©lices pode ser montado em um eixo que pode ser uma extens√£o do eixo de manivelas do motor ou:", a: ["no eixo da caixa de acess√≥rios", "no eixo do trem de engrenagens", "no eixo do comando de v√°lvulas", "nda"], c: 1},
    {q: "O desbalanceamento est√°tico ou din√¢mico, numa h√©lice, pode ocasionar:", a: ["vibra√ß√£o na aeronave", "aumento de RPM no motor", "vibra√ß√£o nos trens de pouso principais", "redu√ß√£o da rota√ß√£o do eixo de manivelas"], c: 0},
    {q: "O eixo da h√©lice √© conectado ao eixo de manivelas, atrav√©s de:", a: ["mancais", "rolamentos", "hastes impulsoras", "engrenagens redutoras"], c: 3},
    {q: "O embandeiramento da h√©lice √© realizado pelo governador, atrav√©s de:", a: ["comando el√©trico", "diminui√ß√£o do RPM", "al√≠vio da press√£o de ar", "al√≠vio da press√£o de √≥leo"], c: 3},
    {q: "O embandeiramento de uma h√©lice ocorre por a√ß√£o de:", a: ["mola e contrapesos", "mola e press√£o de √≥leo", "press√£o de √≥leo e pist√£o", "press√£o de √≥leo e contrapesos"], c: 1},
    {q: "O gelo, que se forma nas p√°s da h√©lice, √© controlado atrav√©s do sistema:", a: ["el√©trico", "pneum√°tico", "de combust√≠vel", "de lubrifica√ß√£o"], c: 0},
    {q: "O passo efetivo da h√©lice √© a diferen√ßa entre o passo:", a: ["m√°ximo e m√≠nimo", "te√≥rico e o recuo", "bandeira e m√≠nimo", "te√≥rico e m√≠nimo"], c: 1},
    {q: "O passo geom√©trico da h√©lice √© igual ao passo:", a: ["te√≥rico, mais o avan√ßo", "efetivo, mais o avan√ßo", "te√≥rico, mais o recuo", "efetivo, mais o recuo"], c: 2},
    {q: "O passo que reconhece o recuo da h√©lice denomina-se:", a: ["efetivo", "te√≥rico", "constante", "geom√©trico"], c: 0},
    {q: "O passo te√≥rico da h√©lice √© igual ao passo:", a: ["efetivo, mais o recuo", "efetivo, mais o avan√ßo", "geom√©trico, menos o recuo", "geom√©trico, menos o avan√ßo"], c: 0},
    {q: "O passo te√≥rico da h√©lice, tamb√©m √© denominado:", a: ["recuo", "avan√ßo", "passo efetivo", "passo geom√©trico"], c: 3},
    {q: "O que √© passo geom√©trico de uma h√©lice?", a: ["√© a dist√¢ncia realmente percorrida por uma h√©lice", "reconhece o recuo da h√©lice no ar", "tamb√©m chamado de passo te√≥rico √© a dist√¢ncia que uma h√©lice deveria avan√ßar em uma revolu√ß√£o", "todas est√£o corretas"], c: 2},
    {q: "O que √© recuo da h√©lice:", a: ["diminui√ß√£o da pot√™ncia do motor", "diferen√ßa entre passo geom√©trico e o efetivo", "mudan√ßa de passo atrav√©s de contra-pesos", "mudan√ßa de √¢ngulo da p√° para o bandeira"], c: 1},
    {q: "O sistema de degelo da h√©lice funciona empregando nos elementos de aquecimento:", a: ["ar quente proveniente da se√ß√£o do compressor", "energia el√©trica transformada em energia calor√≠fica", "ar quente proveniente da se√ß√£o de escapamento do motor", "√≥leo quente do radiador transformado em energia calor√≠fica"], c: 1},
    {q: "Os contrapesos das h√©lices de passo vari√°vel t√™m a finalidade de:", a: ["diminuir a RPM", "aumentar a RPM", "aumentar o passo", "diminuir o passo"], c: 2},
    {q: "Quando a h√©lice d√° uma volta completa e ocorre um recuo a mesma realiza o passo:", a: ["efetivo", "te√≥rico", "de tor√ß√£o", "geom√©trico"], c: 0},
    {q: "Quando a h√©lice d√° uma volta completa, ela dever√° avan√ßar teoricamente uma dist√¢ncia chamada passo:", a: ["real", "efetivo", "de recuo", "geom√©trico"], c: 3},
    {q: "Quando a h√©lice est√° em movimento e h√° forma√ß√£o de gelo nas p√°s, a distor√ß√£o do aerof√≥lio poder√° causar na h√©lice:", a: ["vibra√ß√£o", "aumento de RPM", "mudan√ßa do passo para reverso", "mudan√ßa do passo para o bandeira"], c: 0},
    {q: "Quanto √† h√©lice ajust√°vel no solo, pode-se dizer que a mesma opera como uma h√©lice de passo:", a: ["fixo", "reverso", "autom√°tico", "control√°vel"], c: 0},
    {q: "Se a caixa de engrenagens reduz a velocidade do eixo na propor√ß√£o de 6:1, qual ser√° a rota√ß√£o do eixo de manivelas, sabendo-se que a velocidade da h√©lice √© de 3000 RPM:", a: ["500 RPM", "1800 RPM", "3000 RPM", "18000 RPM"], c: 0},
    {q: "Se a se√ß√£o de engrenagens reduz a velocidade do eixo de manivelas na raz√£o de 11:1, e a velocidade da h√©lice √© de 1200 RPM, a rota√ß√£o do eixo de manivelas ser√° de:", a: ["11200 RPM", "12600 RPM", "13200 RPM", "14400 RPM"], c: 2},
    {q: "Se uma h√©lice gira a 2400 RPM e as engrenagens de redu√ß√£o trabalham em uma raz√£o de 12:1, a rota√ß√£o com que o eixo de manivelas gira √© de:", a: ["200 RPM", "2400 RPM", "4800 RPM", "28800 RPM"], c: 3},
    {q: "Uma das finalidades das engrenagens de redu√ß√£o da caixa de acess√≥rios do motor √©:", a: ["reduzir a velocidade do eixo de ressaltos", "limitar a velocidade de rota√ß√£o da h√©lice", "aumentar a velocidade de rota√ß√£o do motor", "aumentar a velocidade de rota√ß√£o do eixo de manivelas"], c: 1},
    {q: "Uma h√©lice com √¢ngulo negativo, est√° no passo:", a: ["m√≠nimo", "m√°ximo", "reverso", "bandeira"], c: 2},
    {q: "Uma h√©lice revers√≠vel √© uma h√©lice:", a: ["em que o √¢ngulo da p√° pode ser mudado para um valor negativo, durante a opera√ß√£o", "em que o √¢ngulo da p√° diminui o suficiente para evitar que o motor reduza sua rota√ß√£o", "que √© usada como freio aerodin√¢mico e que aumenta a corrida da aeronave ap√≥s o pouso", "que, na condi√ß√£o de falha do motor, muda o passo para que reduza ao m√≠nimo a resist√™ncia ao avan√ßo"], c: 0}
];       

    // CONFIGURA√á√ïES
    const QUESTIONS_PER_SIMULADO = 20;
    let TIME_LIMIT = 0;
    let currentQuestions = [];
    let userAnswers = [];
    let timeLeft = 0;
    let timerId;
    let currentQuestionIndex = 0;
    let autoNavEnabled = true;
    let usedQuestionsHistory = [];
    let currentSimuladoIndices = [];
    const MAX_HISTORY_SIZE = 100;
    
    // GERAR ID √öNICO AUTOMATICAMENTE
    function generateQuizId() {
        const pageTitle = document.title || "Quiz";
        const cleanTitle = pageTitle
            .replace(/[^a-zA-Z0-9\s]/g, '')
            .replace(/\s+/g, '_')
            .toLowerCase()
            .substring(0, 30);
        const titleHash = pageTitle.length.toString(36);
        return `quiz_${cleanTitle}_${titleHash}`;
    }
    
    const QUIZ_ID = generateQuizId();
    const HISTORY_KEY = `${QUIZ_ID}_history`;

    // FUN√á√ÉO PARA ATUALIZAR T√çTULO DA P√ÅGINA
    function updatePageTitle() {
        const totalQuestions = masterBank.length;
        const remaining = Math.max(0, totalQuestions - usedQuestionsHistory.length);
        const isFinaleira = currentQuestions.length < QUESTIONS_PER_SIMULADO && remaining < QUESTIONS_PER_SIMULADO;
        const finaleiraText = isFinaleira ? ' üî• FINALEIRA' : '';
        
        // Pega o t√≠tulo da p√°gina HTML
        const pageTitle = document.title || "Quiz Simulado";
        
        // Limpa prefixos/sufixos comuns
        let cleanTitle = pageTitle
            .replace(/^GMP\s*[-‚Äì‚Äî]\s*/i, '')
            .replace(/^Simulado\s*[-‚Äì‚Äî]\s*/i, '')
            .replace(/^Quiz\s*[-‚Äì‚Äî]\s*/i, '')
            .replace(/\s*[-‚Äì‚Äî]\s*Simulado$/i, '')
            .replace(/\s*[-‚Äì‚Äî]\s*Quiz$/i, '')
            .replace(/\s*[-‚Äì‚Äî]\s*Teste$/i, '')
            .trim();
        
        // Se ficou vazio, usa o t√≠tulo original
        if (!cleanTitle) cleanTitle = pageTitle;
        
        // Garante que n√£o seja muito longo
        if (cleanTitle.length > 40) {
            cleanTitle = cleanTitle.substring(0, 37) + '...';
        }
        
        // Formata o t√≠tulo final
        document.getElementById('page-title').textContent = 
            `${cleanTitle}${finaleiraText} (${currentQuestions.length}/${totalQuestions})`;
        
        return isFinaleira;
    }

    // FUN√á√ïES
    function calculateTimeLimit(questionsCount) {
        return questionsCount * 60;
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // L√≥gica inteligente para sele√ß√£o de quest√µes
    function selectRandomQuestions() {
        const totalQuestions = masterBank.length;
        let availableQuestions = [];
        
        // Todas as quest√µes dispon√≠veis
        for (let i = 0; i < totalQuestions; i++) {
            availableQuestions.push(i);
        }
        
        // Remove as j√° usadas (do hist√≥rico persistente)
        if (usedQuestionsHistory.length > 0) {
            availableQuestions = availableQuestions.filter(index => 
                !usedQuestionsHistory.includes(index)
            );
        }
        
        const availableCount = availableQuestions.length;
        
        // DECIS√ÉO INTELIGENTE: quantas quest√µes usar?
        let questionsToSelect;
        
        if (availableCount === 0) {
            // Se n√£o tem mais quest√µes dispon√≠veis
            if (confirm(`Todas as ${totalQuestions} quest√µes j√° foram usadas!\n\nDeseja reiniciar o hist√≥rico e come√ßar de novo?`)) {
                usedQuestionsHistory = [];
                localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
                availableQuestions = Array.from({length: totalQuestions}, (_, i) => i);
                questionsToSelect = Math.min(QUESTIONS_PER_SIMULADO, totalQuestions);
                alert('Hist√≥rico reiniciado! Todas as quest√µes est√£o dispon√≠veis novamente.');
            } else {
                // Usa todas as quest√µes mesmo (modo de repeti√ß√£o)
                availableQuestions = Array.from({length: totalQuestions}, (_, i) => i);
                questionsToSelect = Math.min(QUESTIONS_PER_SIMULADO, totalQuestions);
            }
        } 
        else if (availableCount >= QUESTIONS_PER_SIMULADO) {
            // Tem quest√µes suficientes para um simulado normal
            questionsToSelect = QUESTIONS_PER_SIMULADO;
        }
        else if (availableCount >= 10) {
            // Tem entre 10 e 19 quest√µes - usa todas dispon√≠veis
            questionsToSelect = availableCount;
        }
        else {
            // Tem menos de 10 quest√µes - oferece op√ß√£o de "finaleira"
            if (confirm(`S√≥ restam ${availableCount} quest√µes dispon√≠veis!\n\nDeseja fazer uma "finaleira" com essas ${availableCount} quest√µes restantes?`)) {
                questionsToSelect = availableCount;
            } else {
                // Usu√°rio n√£o quer fazer finaleira, reinicia hist√≥rico
                if (confirm(`Deseja reiniciar o hist√≥rico e come√ßar um novo ciclo com todas as ${totalQuestions} quest√µes?`)) {
                    usedQuestionsHistory = [];
                    localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
                    availableQuestions = Array.from({length: totalQuestions}, (_, i) => i);
                    questionsToSelect = Math.min(QUESTIONS_PER_SIMULADO, totalQuestions);
                    alert('Hist√≥rico reiniciado!');
                } else {
                    // Continua com as dispon√≠veis mesmo sendo poucas
                    questionsToSelect = availableCount;
                }
            }
        }
        
        // Embaralha as quest√µes dispon√≠veis
        availableQuestions.sort(() => Math.random() - 0.5);
        
        // Seleciona as quest√µes
        const selectedIndices = availableQuestions.slice(0, questionsToSelect);
        
        // Armazena temporariamente (n√£o salva no localStorage ainda)
        currentSimuladoIndices = selectedIndices;
        
        return selectedIndices.map(index => ({
            ...masterBank[index], 
            originalIndex: index
        }));
    }

    function updateSimuladoInfo() {
        const totalQuestions = masterBank.length;
        const remaining = Math.max(0, totalQuestions - usedQuestionsHistory.length);
        const recentUsed = usedQuestionsHistory.length;
        const percentUsed = totalQuestions > 0 ? Math.round((recentUsed / totalQuestions) * 100) : 0;
        
        // Verifica se √© finaleira
        const isFinaleira = currentQuestions.length < QUESTIONS_PER_SIMULADO && remaining < QUESTIONS_PER_SIMULADO;
        
        // Atualiza elementos
        document.getElementById('remaining-questions').textContent = `Dispon√≠veis: ${remaining}`;
        document.getElementById('recent-used').textContent = `Usadas: ${recentUsed}`;
        document.getElementById('questions-per-simulado').textContent = currentQuestions.length;
        
        // Adiciona informa√ß√£o sobre o tamanho do simulado atual
        const simuladoInfo = document.getElementById('simulado-info');
        simuladoInfo.innerHTML = `
            <div>Simulado: <span id="questions-per-simulado">${currentQuestions.length}</span> quest√µes 
            <span style="font-size: 0.6rem; color: ${isFinaleira ? 'var(--warning)' : 'var(--primary)'}">
                ${isFinaleira ? '(finaleira)' : ''}
            </span></div>
            <div class="simulado-stats">
                <span id="remaining-questions">Dispon√≠veis: ${remaining}</span>
                <span id="recent-used">Usadas: ${recentUsed} (${percentUsed}%)</span>
            </div>
            
            <div class="history-controls">
                <button class="clear-history-btn" onclick="clearHistory()">üóëÔ∏è Limpar Hist√≥rico</button>
                <button class="info-history-btn" onclick="showHistoryInfo()">‚ÑπÔ∏è Info</button>
            </div>
        `;
        
        simuladoInfo.style.display = 'block';
    }

    function clearHistory() {
        if (confirm(`Limpar hist√≥rico deste simulado? Todas as ${masterBank.length} quest√µes ficar√£o dispon√≠veis novamente.`)) {
            usedQuestionsHistory = [];
            localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
            
            // Recarrega o simulado com todas as quest√µes dispon√≠veis
            currentQuestions = selectRandomQuestions();
            userAnswers = new Array(currentQuestions.length).fill(null);
            currentQuestionIndex = 0;
            TIME_LIMIT = calculateTimeLimit(currentQuestions.length);
            timeLeft = TIME_LIMIT;
            
            // Atualiza t√≠tulo SEM "finaleira"
            updatePageTitle();
            document.getElementById('timer').textContent = formatTime(timeLeft);
            
            updateSimuladoInfo();
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
            updateFinishButton();
            updatePendingQuestions();
            alert('Hist√≥rico limpo! Novo simulado gerado.');
        }
    }

    function showHistoryInfo() {
        const totalQuestions = masterBank.length;
        const usedCount = usedQuestionsHistory.length;
        const availableCount = Math.max(0, totalQuestions - usedCount);
        const percentUsed = totalQuestions > 0 ? Math.round((usedCount / totalQuestions) * 100) : 0;
        
        let message = `üìä ESTAT√çSTICAS:\n\n`;
        message += `‚Ä¢ Total no banco: ${totalQuestions} quest√µes\n`;
        message += `‚Ä¢ J√° usadas: ${usedCount} (${percentUsed}%)\n`;
        message += `‚Ä¢ Dispon√≠veis: ${availableCount}\n`;
        message += `‚Ä¢ Tamanho padr√£o: ${QUESTIONS_PER_SIMULADO} quest√µes\n\n`;
        
        if (currentSimuladoIndices.length > 0) {
            const isFinaleira = currentQuestions.length < QUESTIONS_PER_SIMULADO && availableCount < QUESTIONS_PER_SIMULADO;
            message += `üìù SIMULADO ATUAL:\n`;
            message += `‚Ä¢ ${currentSimuladoIndices.length} quest√µes\n`;
            if (isFinaleira) {
                message += `‚Ä¢ üî• FINALEIRA (quest√µes restantes)\n`;
            }
            message += `‚Ä¢ Ser√° salvo ao FINALIZAR\n\n`;
        }
        
        if (availableCount < QUESTIONS_PER_SIMULADO && availableCount > 0) {
            message += `‚ö†Ô∏è  ATEN√á√ÉO: S√≥ restam ${availableCount} quest√µes!\n`;
            message += `O pr√≥ximo simulado ser√° uma "finaleira" com as quest√µes restantes.`;
        } else if (availableCount === 0) {
            message += `üéØ CONCLU√çDO: Todas as quest√µes j√° foram usadas!\n`;
            message += `Clique em "Limpar Hist√≥rico" para recome√ßar.`;
        }
        
        alert(message);
    }

    function updatePendingQuestions() {
        const pendingList = document.getElementById('pending-list');
        const pendingCount = document.getElementById('pending-count');
        const answeredCount = getAnsweredCount();
        const pending = currentQuestions.length - answeredCount;
        
        pendingCount.textContent = pending;
        
        if (pending === 0) {
            pendingList.innerHTML = '<span style="color: #28a745;">‚úÖ Todas</span>';
            return;
        }
        
        let html = '';
        let pendingNumbers = [];
        
        for (let i = 0; i < currentQuestions.length; i++) {
            if (userAnswers[i] === null) {
                pendingNumbers.push(i + 1);
            }
        }
        
        const maxToShow = 15;
        const numbersToShow = pendingNumbers.slice(0, maxToShow);
        
        numbersToShow.forEach(num => {
            html += `<span class="pending-number">${num}</span>`;
        });
        
        if (pendingNumbers.length > maxToShow) {
            html += `<span style="color: #6c757d; font-size: 0.55rem;"> +${pendingNumbers.length - maxToShow}</span>`;
        }
        
        pendingList.innerHTML = html || '<span style="color: #6c757d;">Nenhuma</span>';
    }

    function initQuiz() {
        // Carrega hist√≥rico existente
        const savedHistory = localStorage.getItem(HISTORY_KEY);
        if (savedHistory) {
            usedQuestionsHistory = JSON.parse(savedHistory);
        } else {
            usedQuestionsHistory = [];
        }
        
        // Seleciona quest√µes com l√≥gica inteligente
        currentQuestions = selectRandomQuestions();
        TIME_LIMIT = calculateTimeLimit(currentQuestions.length);
        
        // Atualiza t√≠tulo (mostra "finaleira" se for o caso)
        updatePageTitle();
        
        userAnswers = new Array(currentQuestions.length).fill(null);
        timeLeft = TIME_LIMIT;
        currentQuestionIndex = 0;
        autoNavEnabled = true;
        
        document.getElementById('timer').textContent = formatTime(timeLeft);
        document.getElementById('auto-nav-checkbox').checked = true;
        
        updateSimuladoInfo();
        startTimer();
        renderCurrentQuestion();
        updateCounters();
        updateNavButtons();
        updateFinishButton();
        updatePendingQuestions();
    }

    function generateNewSimulado() {
        const totalAvailable = Math.max(0, masterBank.length - usedQuestionsHistory.length);
        
        let message;
        if (totalAvailable === 0) {
            message = `Todas as ${masterBank.length} quest√µes j√° foram usadas!\n\nDeseja reiniciar o hist√≥rico e gerar novo simulado?`;
        } else if (totalAvailable < QUESTIONS_PER_SIMULADO) {
            message = `S√≥ restam ${totalAvailable} quest√µes dispon√≠veis.\n\nDeseja fazer um simulado com essas ${totalAvailable} quest√µes restantes?`;
        } else {
            message = `Gerar novo simulado com ${Math.min(QUESTIONS_PER_SIMULADO, totalAvailable)} quest√µes?`;
        }
        
        if (confirm(message)) {
            if (totalAvailable === 0) {
                // Reinicia hist√≥rico se n√£o tem mais quest√µes
                usedQuestionsHistory = [];
                localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
                alert('Hist√≥rico reiniciado! Todas as quest√µes est√£o dispon√≠veis.');
            }
            
            document.getElementById('results').style.display = 'none';
            document.getElementById('finish-btn').style.display = 'block';
            document.getElementById('restart-btn').style.display = 'none';
            document.getElementById('new-simulado-btn').style.display = 'none';
            document.querySelector('.nav-buttons').style.display = 'flex';
            
            // Seleciona novas quest√µes
            currentQuestions = selectRandomQuestions();
            TIME_LIMIT = calculateTimeLimit(currentQuestions.length);
            userAnswers = new Array(currentQuestions.length).fill(null);
            timeLeft = TIME_LIMIT;
            currentQuestionIndex = 0;
            
            // Atualiza t√≠tulo
            updatePageTitle();
            
            document.getElementById('timer').textContent = formatTime(timeLeft);
            startTimer();
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
            updateFinishButton();
            updatePendingQuestions();
            updateSimuladoInfo();
        }
    }

    function renderCurrentQuestion() {
        const container = document.getElementById('quiz-content');
        
        if (!currentQuestions || currentQuestions.length === 0) {
            container.innerHTML = '<div class="question-block-mini">Erro: Nenhuma quest√£o.</div>';
            return;
        }
        
        const question = currentQuestions[currentQuestionIndex];
        
        container.innerHTML = `
            <div class="question-block-mini">
                <div class="question-text-mini">
                    ${currentQuestionIndex + 1}. ${question.q}
                </div>
                <div class="options-mini">
                    ${question.a.map((opt, i) => `
                        <label class="option-mini" id="option-${i}">
                            <input type="radio" name="currentQuestion" value="${i}" 
                                   ${userAnswers[currentQuestionIndex] === i ? 'checked' : ''}
                                   onchange="selectAnswer(${i})">
                            ${opt}
                        </label>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function selectAnswer(answerIndex) {
        userAnswers[currentQuestionIndex] = answerIndex;
        updateCounters();
        updateFinishButton();
        updatePendingQuestions();
        
        if (autoNavEnabled && currentQuestionIndex < currentQuestions.length - 1) {
            setTimeout(() => {
                nextQuestion();
            }, 200);
        }
    }

    function toggleAutoNav() {
        autoNavEnabled = !autoNavEnabled;
        document.getElementById('auto-nav-checkbox').checked = autoNavEnabled;
    }

    function getAnsweredCount() {
        return userAnswers.filter(answer => answer !== null).length;
    }

    function updateFinishButton() {
        const finishBtn = document.getElementById('finish-btn');
        const answeredCount = getAnsweredCount();
        const allAnswered = answeredCount === currentQuestions.length;
        
        finishBtn.disabled = !allAnswered;
        finishBtn.innerHTML = allAnswered ? 'üèÅ Finalizar' : `‚ùå Faltam ${currentQuestions.length - answeredCount}`;
    }

    function updateNavButtons() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === currentQuestions.length - 1;
        nextBtn.innerHTML = currentQuestionIndex === currentQuestions.length - 1 ? '√öltima' : 'Pr√≥ximo ‚Üí';
    }

    function updateCounters() {
        const answeredCount = getAnsweredCount();
        
        document.getElementById('question-counter').textContent = `${currentQuestionIndex + 1}/${currentQuestions.length}`;
        document.getElementById('answered-counter').textContent = `${answeredCount}/${currentQuestions.length}`;
        document.getElementById('progress-percent').textContent = `${currentQuestions.length > 0 ? Math.round((answeredCount / currentQuestions.length) * 100) : 0}%`;
        document.getElementById('status-count').textContent = `${answeredCount}/${currentQuestions.length}`;
        
        updateTimerDisplay();
    }

    function updateTimerDisplay() {
        const timerElement = document.getElementById('timer');
        timerElement.textContent = formatTime(timeLeft);
        
        if (timeLeft <= Math.min(300, Math.floor(TIME_LIMIT * 0.25))) {
            timerElement.classList.add('timer-warning');
        } else {
            timerElement.classList.remove('timer-warning');
        }
    }

    function startTimer() {
        clearInterval(timerId);
        
        timerId = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(timerId);
                if (getAnsweredCount() === currentQuestions.length) {
                    finalizeQuiz();
                } else {
                    if (confirm('Tempo esgotado! Deseja finalizar o simulado?')) {
                        finalizeQuiz();
                    }
                }
            }
        }, 1000);
    }

    function nextQuestion() {
        if (currentQuestionIndex < currentQuestions.length - 1) {
            currentQuestionIndex++;
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
        }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
        }
    }

    function finalizeQuiz() {
        clearInterval(timerId);
        
        const answeredCount = getAnsweredCount();
        if (answeredCount !== currentQuestions.length && !confirm(`Respondidas: ${answeredCount}/${currentQuestions.length}. Finalizar?`)) {
            startTimer();
            return;
        }
        
        let finalScore = 0;
        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer === currentQuestions[index].c) {
                finalScore++;
            }
        });
        
        const percent = currentQuestions.length > 0 ? Math.round((finalScore / currentQuestions.length) * 100) : 0;
        const feedback = document.getElementById('feedback-msg');
        
        if (percent >= 70) feedback.textContent = "üéâ Aprovado!";
        else if (percent >= 50) feedback.textContent = "üëç Quase l√°!";
        else feedback.textContent = "üí™ Continue!";
        
        feedback.style.color = percent >= 70 ? "var(--success)" : percent >= 50 ? "var(--accent)" : "var(--danger)";
        
        // AGORA SIM: Adiciona ao hist√≥rico persistente
        if (currentSimuladoIndices.length > 0) {
            usedQuestionsHistory.push(...currentSimuladoIndices);
            
            // Remove duplicatas
            usedQuestionsHistory = [...new Set(usedQuestionsHistory)];
            
            // Limita o tamanho do hist√≥rico
            if (usedQuestionsHistory.length > MAX_HISTORY_SIZE) {
                usedQuestionsHistory = usedQuestionsHistory.slice(-MAX_HISTORY_SIZE);
            }
            
            // Salva no localStorage
            localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
        }
        
        // Mostra quest√µes com cores
        let quizHTML = '';
        currentQuestions.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === question.c;
            
            quizHTML += `
                <div class="question-block-mini">
                    <div class="question-text-mini">
                        ${index + 1}. ${question.q}
                    </div>
                    <div class="options-mini">
                        ${question.a.map((opt, i) => {
                            let classes = 'option-mini';
                            if (i === question.c) classes += ' correct-answer';
                            else if (userAnswer === i && !isCorrect) classes += ' wrong-answer';
                            
                            return `<label class="${classes}">
                                <input type="radio" disabled ${userAnswer === i ? 'checked' : ''}>
                                ${opt}
                            </label>`;
                        }).join('')}
                    </div>
                </div>
            `;
        });
        
        document.getElementById('quiz-content').innerHTML = quizHTML;
        document.getElementById('final-score').textContent = `${finalScore}/${currentQuestions.length}`;
        document.getElementById('final-percent').textContent = `${percent}%`;
        
        const totalQuestions = masterBank.length;
        const remainingQuestions = Math.max(0, totalQuestions - usedQuestionsHistory.length);
        const percentComplete = totalQuestions > 0 ? Math.round((usedQuestionsHistory.length / totalQuestions) * 100) : 0;
        
        let summaryText = '';
        if (remainingQuestions === 0) {
            summaryText = `üéØ PARAB√âNS! Voc√™ completou TODAS as ${totalQuestions} quest√µes!`;
        } else if (remainingQuestions < QUESTIONS_PER_SIMULADO) {
            summaryText = `üî• Restam apenas ${remainingQuestions} quest√µes para a finaleira!<br>Progresso total: ${percentComplete}%`;
        } else {
            summaryText = `Quest√µes deste simulado foram adicionadas ao hist√≥rico.<br>Restantes: <strong>${remainingQuestions}</strong> | Total usadas: <strong>${usedQuestionsHistory.length}</strong> (${percentComplete}%)`;
        }
        
        document.getElementById('simulado-summary').innerHTML = summaryText;
        
        document.querySelector('.nav-buttons').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        document.getElementById('finish-btn').style.display = 'none';
        document.getElementById('restart-btn').style.display = 'block';
        document.getElementById('new-simulado-btn').style.display = 'block';
        
        // Atualiza info do simulado
        updateSimuladoInfo();
    }

    function resetQuiz() {
        if (confirm('Reiniciar este simulado? Suas respostas ser√£o perdidas, mas as quest√µes N√ÉO ser√£o salvas no hist√≥rico.')) {
            userAnswers = new Array(currentQuestions.length).fill(null);
            timeLeft = TIME_LIMIT;
            currentQuestionIndex = 0;
            
            startTimer();
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
            updateFinishButton();
            updatePendingQuestions();
        }
    }

    function startNewQuiz() {
        document.getElementById('results').style.display = 'none';
        document.getElementById('finish-btn').style.display = 'block';
        document.getElementById('restart-btn').style.display = 'none';
        document.getElementById('new-simulado-btn').style.display = 'none';
        document.querySelector('.nav-buttons').style.display = 'flex';
        
        // Usa as MESMAS quest√µes (n√£o gera novas)
        userAnswers = new Array(currentQuestions.length).fill(null);
        timeLeft = TIME_LIMIT;
        currentQuestionIndex = 0;
        
        startTimer();
        renderCurrentQuestion();
        updateCounters();
        updateNavButtons();
        updateFinishButton();
        updatePendingQuestions();
    }

    // Atalhos de teclado
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === ' ') nextQuestion();
        if (e.key === 'ArrowLeft') prevQuestion();
    });

    // Inicializar quando a p√°gina carregar
    window.onload = function() {
        initQuiz();
    };
</script>

</body>

</html>
