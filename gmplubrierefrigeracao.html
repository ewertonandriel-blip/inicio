<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GMP - SISTEMA DE LUBRIFICA√á√ÉO E REFRIGERA√á√ÉO</title>
    <style>
        :root {
            --primary: #1a3a5a;
            --accent: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 4px;
            font-size: 13px;
            line-height: 1.3;
        }

        .container {
            max-width: 100%;
            background: white;
            padding: 6px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
            margin: 0 auto;
        }

        .credits-integrated {
            position: absolute;
            top: 2px;
            right: 6px;
            background: var(--primary);
            color: white;
            padding: 1px 3px;
            font-size: 0.5rem;
            font-weight: bold;
            border-radius: 1px;
            z-index: 10;
        }

        /* CABE√áALHO SUPER COMPACTO */
        .header-mini {
            position: sticky;
            top: 0;
            background: white;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--primary);
            z-index: 5;
            margin-bottom: 6px;
            padding-top: 16px;
        }

        .header-mini-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .page-title-mini {
            margin: 0;
            color: var(--primary);
            font-size: 0.85rem;
            font-weight: bold;
            line-height: 1.1;
            max-width: 65%;
        }

        .timer-compact {
            background: #f8f9fa;
            color: var(--primary);
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 0.75rem;
            font-weight: bold;
            border: 1px solid #dee2e6;
            min-width: 40px;
            text-align: center;
        }

        .timer-warning {
            background: #fff5f5 !important;
            color: var(--danger) !important;
            border-color: var(--danger) !important;
        }

        /* INFO DO SIMULADO MAIS COMPACTA */
        .simulado-info {
            background: #e7f3ff;
            border: 1px solid var(--accent);
            border-radius: 3px;
            padding: 4px 5px;
            margin-bottom: 5px;
            font-size: 0.65rem;
            color: var(--primary);
            display: none;
        }

        .simulado-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 2px;
            font-weight: 600;
        }

        /* CONTROLES DE HIST√ìRICO COMPACTOS */
        .history-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-top: 4px;
        }

        .history-controls button {
            padding: 2px 4px;
            font-size: 0.6rem;
            border-radius: 2px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            text-align: center;
        }

        .clear-history-btn {
            background: var(--warning);
            color: #856404;
            border: 1px solid #ffc107;
        }

        .info-history-btn {
            background: #6c757d;
            color: white;
        }

        /* INFO B√ÅSICA SUPER COMPACTA */
        .quiz-info-mini {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 5px 6px;
            border: 1px solid #dee2e6;
            margin-bottom: 4px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin-bottom: 4px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.55rem;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0;
        }

        .info-value {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* CONTROLES COMPACTOS */
        .controls-compact {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 4px;
        }

        .auto-nav-toggle {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 2px 4px;
            background: #e9ecef;
            border-radius: 2px;
            cursor: pointer;
            font-size: 0.65rem;
        }

        .auto-nav-checkbox {
            transform: scale(0.8);
            accent-color: var(--primary);
        }

        .auto-nav-label {
            font-weight: 600;
            color: var(--primary);
            white-space: nowrap;
        }

        .reset-btn-mini {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 2px;
            padding: 2px 4px;
            font-size: 0.65rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
        }

        /* STATUS COMPACTO */
        .completion-status {
            background: #f8f9fa;
            border-radius: 3px;
            padding: 4px 5px;
            margin: 5px 0;
            border: 1px solid #dee2e6;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
        }

        .status-text {
            font-size: 0.65rem;
            font-weight: 600;
        }

        .status-count {
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* PENDENTES SUPER COMPACTOS */
        .pending-compact {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 2px;
            padding: 2px 3px;
            font-size: 0.6rem;
        }

        .pending-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1px;
        }

        .pending-count {
            font-weight: bold;
            color: #856404;
            font-size: 0.65rem;
        }

        .pending-list-compact {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            max-height: 18px;
            overflow-y: auto;
            padding: 1px 0;
        }

        .pending-number {
            background: #ffc107;
            color: #856404;
            font-weight: bold;
            padding: 0 2px;
            border-radius: 1px;
            font-size: 0.55rem;
            min-width: 12px;
            text-align: center;
            line-height: 1.2;
        }

        .pending-number.answered {
            background: #28a745;
            color: white;
            opacity: 0.5;
        }

        /* QUEST√ïES COMPACTAS */
        .question-block-mini {
            margin: 6px 0;
            padding: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            background: #fff;
            position: relative;
        }

        .question-text-mini {
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 6px;
            color: var(--primary);
            line-height: 1.2;
        }

        .options-mini {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .option-mini {
            padding: 5px 6px;
            border: 1px solid #eee;
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.75rem;
            min-height: 28px;
            position: relative;
        }

        input[type="radio"] {
            margin-right: 4px;
            transform: scale(0.8);
            accent-color: var(--primary);
        }

        .correct-answer {
            background-color: #d4edda !important;
            border-color: #28a745 !important;
            color: #155724;
        }

        .wrong-answer {
            background-color: #f8d7da !important;
            border-color: #dc3545 !important;
            color: #721c24;
        }

        /* BOT√ÉO DE REPORTAR NAS QUEST√ïES */
        .report-btn {
            background: transparent;
            color: #6c757d;
            border: 1px solid #dee2e6;
            border-radius: 2px;
            padding: 2px 6px;
            font-size: 0.55rem;
            cursor: pointer;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 3px;
            transition: all 0.2s;
        }

        .report-btn:hover {
            background: #f8f9fa;
            color: var(--danger);
            border-color: var(--danger);
        }

        /* BOT√ÉO DE REPORTAR NO GABARITO (canto superior direito) */
        .report-gabarito-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: transparent;
            color: #6c757d;
            border: 1px solid #dee2e6;
            border-radius: 2px;
            padding: 1px 4px;
            font-size: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 2px;
            transition: all 0.2s;
            z-index: 2;
        }

        .report-gabarito-btn:hover {
            background: #f8f9fa;
            color: var(--danger);
            border-color: var(--danger);
        }

        /* BOT√ïES DE NAVEGA√á√ÉO COMPACTOS */
        .nav-buttons {
            display: flex;
            gap: 4px;
            margin: 8px 0;
        }

        .nav-btn {
            flex: 1;
            padding: 6px 4px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 2px;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            text-align: center;
            min-height: 32px;
        }

        .nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* BOT√ïES PRINCIPAIS COMPACTOS */
        .btn {
            padding: 8px;
            font-size: 0.8rem;
            font-weight: bold;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            width: 100%;
            margin-top: 8px;
            min-height: 36px;
        }

        .btn-finish {
            background: var(--primary);
            color: white;
        }

        .btn-finish:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-restart {
            background: var(--success);
            color: white;
            display: none;
        }

        /* RESULTADOS COMPACTOS */
        #results {
            display: none;
            padding: 10px;
            text-align: center;
            border: 1px solid var(--primary);
            margin: 8px 0;
            border-radius: 3px;
            background: #f8f9fa;
        }

        .result-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--primary);
        }

        .score-mini {
            font-size: 1.1rem;
            margin: 4px 0;
            font-weight: 800;
            color: var(--primary);
        }

        /* MODAL DE REPORTE - ATUALIZADO */
        .report-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .report-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            width: 95%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .report-title {
            font-size: 1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .report-question-info {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }

        .report-question-info strong {
            color: var(--primary);
        }

        .report-section {
            margin-bottom: 15px;
        }

        .report-section-title {
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .report-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 10px 0;
        }

        .report-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .report-option:hover {
            background: #f8f9fa;
            border-color: var(--accent);
        }

        .report-option input[type="radio"] {
            margin: 0;
            transform: scale(0.9);
        }

        .report-option label {
            font-size: 0.75rem;
            cursor: pointer;
            flex: 1;
        }

        /* FORMUL√ÅRIO DE IDENTIFICA√á√ÉO */
        .user-info-form {
            background: #f0f8ff;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #cce5ff;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .form-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }

        .form-input.error {
            border-color: var(--danger);
            background-color: #fff5f5;
        }

        .form-hint {
            font-size: 0.65rem;
            color: #6c757d;
            margin-top: 4px;
            display: block;
        }

        .required-star {
            color: var(--danger);
            font-weight: bold;
        }

        .report-textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 0.8rem;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .report-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }

        .report-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .report-submit {
            flex: 2;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .report-submit:hover {
            background: #0d2c4a;
        }

        .report-submit:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .report-cancel {
            flex: 1;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .report-cancel:hover {
            background: #545b62;
        }

        .report-success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 5px;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 15px;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .report-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.75rem;
            text-align: center;
            margin-top: 10px;
            border: 1px solid #f5c6cb;
            display: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* SCROLL PERSONALIZADO */
        .pending-list-compact::-webkit-scrollbar {
            height: 2px;
        }
        
        .pending-list-compact::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 1px;
        }
        
        .pending-list-compact::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 1px;
        }

        /* AJUSTES PARA TELAS MUITO PEQUENAS */
        @media (max-width: 320px) {
            body {
                padding: 2px;
                font-size: 12px;
            }
            
            .container {
                padding: 4px;
            }
            
            .page-title-mini {
                font-size: 0.75rem;
                max-width: 60%;
            }
            
            .timer-compact {
                font-size: 0.7rem;
                min-width: 35px;
                padding: 1px 3px;
            }
            
            .info-grid {
                gap: 3px;
            }
            
            .info-label {
                font-size: 0.5rem;
            }
            
            .info-value {
                font-size: 0.7rem;
            }
            
            .question-text-mini {
                font-size: 0.75rem;
            }
            
            .option-mini {
                padding: 4px 5px;
                font-size: 0.7rem;
                min-height: 26px;
            }
            
            .nav-btn, .btn {
                font-size: 0.7rem;
                padding: 5px 3px;
            }
            
            .pending-list-compact {
                max-height: 16px;
            }
            
            .pending-number {
                font-size: 0.5rem;
                min-width: 10px;
            }
            
            .report-gabarito-btn {
                font-size: 0.45rem;
                padding: 1px 3px;
            }
            
            .report-content {
                padding: 15px;
            }
            
            .report-buttons {
                flex-direction: column;
            }
        }

        @media (max-height: 600px) {
            .header-mini {
                padding-top: 10px;
            }
            
            .question-block-mini {
                margin: 4px 0;
                padding: 6px;
            }
            
            .nav-buttons {
                margin: 6px 0;
            }
            
            .btn {
                margin-top: 6px;
                min-height: 32px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="credits-integrated">BY EWERTON</div>
    
    <div class="header-mini">
        <div class="header-mini-top">
            <h1 class="page-title-mini" id="page-title">Carregando...</h1>
            <div id="timer" class="timer-compact">00:00</div>
        </div>
        
        <div class="simulado-info" id="simulado-info">
            <div>Simulado: <span id="questions-per-simulado">20</span> quest√µes</div>
            <div class="simulado-stats">
                <span id="remaining-questions">Dispon√≠veis: 0</span>
                <span id="recent-used">Usadas: 0</span>
            </div>
            
            <div class="history-controls">
                <button class="clear-history-btn" onclick="clearHistory()">
                    üóëÔ∏è Limpar Hist√≥rico
                </button>
                <button class="info-history-btn" onclick="showHistoryInfo()">
                    ‚ÑπÔ∏è Info
                </button>
            </div>
        </div>
        
        <div class="quiz-info-mini">
            <div class="info-grid">
                <div class="info-item">
                    <div class="info-label">Quest√£o</div>
                    <div class="info-value" id="question-counter">0/0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Respondidas</div>
                    <div class="info-value" id="answered-counter">0/0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">Progresso</div>
                    <div class="info-value" id="progress-percent">0%</div>
                </div>
            </div>
            
            <div class="controls-compact">
                <div class="auto-nav-toggle" onclick="toggleAutoNav()">
                    <input type="checkbox" id="auto-nav-checkbox" class="auto-nav-checkbox" checked>
                    <label class="auto-nav-label">Auto-navega√ß√£o</label>
                </div>
                <button class="reset-btn-mini" onclick="resetQuiz()">
                    ‚Üª Reiniciar
                </button>
            </div>
        </div>

        <div class="completion-status">
            <div class="status-header">
                <span class="status-text">Status:</span>
                <span class="status-count" id="status-count">0/0</span>
            </div>
            <div class="pending-compact" id="pending-questions">
                <div class="pending-summary">
                    <span>Pendentes:</span>
                    <span class="pending-count" id="pending-count">0</span>
                </div>
                <div class="pending-list-compact" id="pending-list">
                    <span style="color: #6c757d; font-style: italic;">Nenhuma pendente</span>
                </div>
            </div>
        </div>
    </div>

    <div id="results">
        <div class="result-title" id="feedback-msg"></div>
        <div class="score-mini" id="final-score"></div>
        <div id="final-percent" style="font-size: 0.8rem; font-weight: bold; margin-bottom: 6px; color: var(--accent);"></div>
        <div id="simulado-summary" style="margin-bottom: 8px; font-size: 0.7rem; color: var(--primary);"></div>
        <button id="restart-btn" class="btn btn-restart" onclick="startNewQuiz()">üîÑ Refazer</button>
        <button id="new-simulado-btn" class="btn" style="background: var(--accent); color: white; margin-top: 4px; display: none;" onclick="generateNewSimulado()">üé≤ Novo Simulado</button>
    </div>

    <div id="quiz-content"></div>

    <div class="nav-buttons">
        <button id="prev-btn" class="nav-btn" onclick="prevQuestion()" disabled>
            ‚Üê Anterior
        </button>
        <button id="next-btn" class="nav-btn" onclick="nextQuestion()">
            Pr√≥ximo ‚Üí
        </button>
    </div>

    <button id="finish-btn" class="btn btn-finish" onclick="finalizeQuiz()" disabled>
        üèÅ Finalizar
    </button>
</div>

<!-- MODAL DE REPORTE ATUALIZADO -->
<div id="reportModal" class="report-modal">
    <div class="report-content">
        <div class="report-title">üìù Reportar Quest√£o</div>
        
        <div class="report-question-info">
            <div><strong>Quest√£o #<span id="reportQuestionNumber">1</span></strong></div>
            <div id="reportQuestionText" style="font-size: 0.75rem; margin-top: 5px;">Carregando...</div>
        </div>
        
        <!-- SE√á√ÉO: TIPO DE PROBLEMA -->
        <div class="report-section">
            <div class="report-section-title">üìå Tipo de Problema</div>
            <div class="report-options">
                <div class="report-option">
                    <input type="radio" id="reportError" name="reportType" value="error">
                    <label for="reportError">‚ùå Quest√£o com erro</label>
                </div>
                <div class="report-option">
                    <input type="radio" id="reportWrongAnswer" name="reportType" value="wrong_answer">
                    <label for="reportWrongAnswer">‚ö†Ô∏è Resposta incorreta</label>
                </div>
                <div class="report-option">
                    <input type="radio" id="reportConfusing" name="reportType" value="confusing">
                    <label for="reportConfusing">ü§î Enunciado confuso</label>
                </div>
                <div class="report-option">
                    <input type="radio" id="reportAlternative" name="reportType" value="alternative">
                    <label for="reportAlternative">üî§ Alternativas erradas</label>
                </div>
                <div class="report-option">
                    <input type="radio" id="reportOther" name="reportType" value="other">
                    <label for="reportOther">üìù Outro problema</label>
                </div>
            </div>
        </div>
        
        <!-- SE√á√ÉO: SUA IDENTIFICA√á√ÉO -->
        <div class="report-section">
            <div class="report-section-title">üë§ Sua Identifica√ß√£o <span class="required-star">*</span></div>
            <div class="user-info-form">
                <div class="form-group">
                    <label class="form-label" for="userName">Nome Completo <span class="required-star">*</span></label>
                    <input type="text" id="userName" class="form-input" placeholder="Digite seu nome completo" maxlength="100">
                    <span class="form-hint">Para podermos entrar em contato com voc√™</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="userEmail">E-mail <span class="required-star">*</span></label>
                    <input type="email" id="userEmail" class="form-input" placeholder="seu.email@exemplo.com" maxlength="100">
                    <span class="form-hint">Para enviarmos o feedback sobre sua solicita√ß√£o</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="userInfo">Institui√ß√£o/Curso (opcional)</label>
                    <input type="text" id="userInfo" class="form-input" placeholder="Ex: SENAI, Engenharia Mec√¢nica" maxlength="100">
                    <span class="form-hint">Ajuda a identificar o contexto do reporte</span>
                </div>
            </div>
        </div>
        
        <!-- SE√á√ÉO: DETALHES -->
        <div class="report-section">
            <div class="report-section-title">üìã Detalhes do Problema</div>
            <textarea 
                id="reportDetails" 
                class="report-textarea" 
                placeholder="Descreva detalhadamente o problema encontrado na quest√£o. Se achar que h√° erro na resposta, explique sua justificativa..."
                maxlength="1000"
            ></textarea>
            <div class="form-hint" style="text-align: right;">
                <span id="charCount">0</span>/1000 caracteres
            </div>
        </div>
        
        <div id="reportErrorMsg" class="report-error"></div>
        
        <div class="report-buttons">
            <button id="cancelReport" class="report-cancel">Cancelar</button>
            <button id="submitReport" class="report-submit">
                <span id="submitText">Enviar Reporte</span>
                <span id="submitLoading" class="loading-spinner" style="display: none;"></span>
            </button>
        </div>
        
        <div id="reportSuccess" class="report-success">
            ‚úÖ Reporte enviado com sucesso! Obrigado pela contribui√ß√£o.<br>
            <small>Voc√™ receber√° um feedback por email em breve.</small>
        </div>
    </div>
</div>

<script>
    // ============================================
    // COLE SUAS QUEST√ïES AQUI (entre os colchetes)
    // ============================================
    const masterBank = [
 
{q: "A bomba de suc√ß√£o do sistema de lubrifica√ß√£o tem a finalidade de:", a: ["aliviar a press√£o do sistema", "retornar o √≥leo para o tanque", "circular o √≥leo atrav√©s do motor", "garantir a ventila√ß√£o do tanque"], c: 1},
{q: "A finalidade da bomba de suc√ß√£o no sistema de lubrifica√ß√£o do motor √©:", a: ["retornar o √≥leo ao tanque", "conduzir o √≥leo para o radiador", "circular o √≥leo atrav√©s do motor", "suprir √≥leo para a bomba principal"], c: 0},
{q: "A finalidade de instalar o tanque de √≥leo do motor em local acima da bomba √© garantir:", a: ["que o √≥leo circule descontaminado", "a circula√ß√£o do √≥leo caso o filtro entupa", "que o √≥leo n√£o trasborde quando no abastecimento", "o suprimento na linha da bomba por gravidade"], c: 3},
{q: "A finalidade de N√ÉO se encher o tanque de √≥leo totalmente √©:", a: ["limitar a viscosidade de √≥leo", "compensar a expans√£o t√©rmica do √≥leo", "facilitar a passagem do √≥leo pelo radiador", "evitar que o √≥leo congele quando o avi√£o estiver voando em regi√£o de baixa temperatura"], c: 1},
{q: "A forma√ß√£o de gelo na entrada do motor pode alterar o ciclo de refrigera√ß√£o do mesmo, ocasionando:", a: ["aumento de empuxo", "baixa indica√ß√£o de TIT", "temperatura do ar de escapamento", "danos √†s palhetas da turbina devido a um superaquecimento"], c: 3},
{q: "A inspe√ß√£o com buj√µes magn√©ticos permite verificar se o motor est√° com:", a: ["o √≥leo sujo", "√°gua do √≥leo", "limalha de a√ßo", "limalha de bronze"], c: 2},
{q: "A instala√ß√£o do tubo do bocal de abastecimento, no tanque de √≥leo, √© posicionado de forma a prover o(a):", a: ["suspiro do tanque", "ventila√ß√£o do tanque", "espa√ßo suficiente √† expans√£o do √≥leo", "pressuriza√ß√£o do sistema de lubrifica√ß√£o"], c: 2},
{q: "A press√£o do √≥leo do motor √© medida por um instrumento que emprega um mecanismo do tipo:", a: ["sonda", "termopar", "tubo de venture", "tubo de bourdon"], c: 3},
{q: "A substitui√ß√£o do elemento filtrante do filtro de √≥leo \"n√£o\" ser√° necess√°rio quando:", a: ["o motor sofrer revis√£o geral", "for completado o n√≠vel no reservat√≥rio", "o motor girar sem indica√ß√£o de press√£o", "for substitu√≠do o √≥leo por ter sido contaminado com limalha"], c: 1},
{q: "A temperatura do √≥leo do sistema de lubrifica√ß√£o do motor convencional √© controlada atrav√©s de uma v√°lvula denominada:", a: ["pneum√°tica", "sensora", "termost√°tica", "magn√©tica"], c: 2},
{q: "A utiliza√ß√£o de √≥leo lubrificante com alta viscosidade dificulta o (a):", a: ["corte do motor em tempo frio", "corte do motor em tempo quente", "partida do motor em tempo frio", "partida do motor em tempo quente"], c: 2},
{q: "A utiliza√ß√£o de √≥leo lubrificante com baixa viscosidade facilita a:", a: ["partida em tempo quente", "refrigera√ß√£o dos motores", "mudan√ßa dos passos das h√©lices", "lubrifica√ß√£o em baixa temperatura"], c: 3},
{q: "A utiliza√ß√£o de √≥leo lubrificante com baixa viscosidade facilita o(a):", a: ["corte do motor em tempo frio", "partida do motor em tempo frio", "corte do motor em tempo quente", "partida do motor em tempo quente"], c: 1},
{q: "A v√°lvula de al√≠vio do sistema de lubrifica√ß√£o tem a finalidade de:", a: ["limitar a press√£o de √≥leo do sistema", "permitir que o √≥leo n√£o entre no motor", "drenar o √≥leo em excesso para a linha de abastecimento", "determinar que das vias de √≥leo ser√° tomada em dire√ß√£o ao radiador"], c: 0},
{q: "A v√°lvula que determina qual das vias de √≥leo ser√° tomada em dire√ß√£o ao radiador:", a: ["dreno", "al√≠vio", "by-pass", "controle de fluxo"], c: 3},
{q: "A viscosidade do √≥leo √© afetada alterando o(a) seu(sua):", a: ["temperatura", "fluxo", "volume", "press√£o"], c: 0},
{q: "Antes de o motor convencional novo ser testado, ele deve ser:", a: ["drenado", "pr√©-lubrificado", "dado partida em seco", "posto em marcha lenta"], c: 1},
{q: "Antes de usar qualquer m√©todo de pr√©-lubrifica√ß√£o dos rolamentos, para permitir que o motor possa ser girado mais facilmente, deve-se:", a: ["ligar os magnetos", "desligar os magnetos", "instalar todas as velas", "remover um vela de cada cilindro"], c: 3},
{q: "As bombas que circulam o √≥leo atrav√©s do motor e as que retornam o √≥leo para o reservat√≥rio s√£o, respectivamente do tipo:", a: ["suc√ß√£o e suc√ß√£o", "suc√ß√£o e retorno", "press√£o e suc√ß√£o", "press√£o e press√£o"], c: 2},
{q: "As bombas que circulam o √≥leo atrav√©s do motor e as que retornam o √≥leo para o reservat√≥rio s√£o, respectivamente, do tipo:", a: ["suc√ß√£o e suc√ß√£o", "suc√ß√£o e press√£o", "press√£o e suc√ß√£o", "press√£o e press√£o"], c: 2},
{q: "Dentre as alternativas abaixo, aquela que identifica os m√©todos de distribui√ß√£o do √≥leo para a lubrifica√ß√£o das diversas pe√ßas m√≥veis do motor, √© o(a):", a: ["decanta√ß√£o e suc√ß√£o", "press√£o e compress√£o", "salpique e press√£o", "pulveriza√ß√£o e compress√£o"], c: 2},
{q: "Dentre os tipos de √≥leo abaixo aquele que tem menor viscosidade √© o:", a: ["SAE 20", "SAE 40", "SAE 50", "SAE 60"], c: 0},
{q: "Dentre os tipos de √≥leo abaixo, aquele que tem menor viscosidade √© o:", a: ["SAE 20", "SAE 40", "SAE 50", "SAE 60"], c: 0},
{q: "Dispositivo do sistema lubrifica√ß√£o que permite regular a temperatura do √≥leo lubrificante √© o (a):", a: ["tanque", "filtro de oleo", "bomba de retorno", "v√°lvula termost√°tica"], c: 3},
{q: "Em um motor a rea√ß√£o a refrigera√ß√£o da c√¢mara de combust√£o √© realizada:", a: ["pelo pr√≥prio combust√≠vel", "pelo √≥leo do sistema de lubrifica√ß√£o", "por ar de impacto", "com metanol"], c: 2},
{q: "No √≥leo do tipo SAE 40w, a indica√ß√£o que o mesmo √© satisfat√≥rio para clima frio √©:", a: ["W", "40", "40W", "SAE"], c: 0},
{q: "No reparo de um tanque de √≥leo, em que seja necess√°ria sua remo√ß√£o, o primeiro procedimento a ser", a: ["remover o motor da aeronave", "drenar o √≥leo", "desconectar a bra√ßadeira de fixa√ß√£o do tanque", "desconectar as tubula√ß√µes das linhas de entrada e sa√≠da"], c: 1},
{q: "No sistema de lubrifica√ß√£o de um motor convencional, quando a temperatura do √≥leo cai abaixo de um determinado limite, a v√°lvula termost√°tica:", a: ["abre-se, permitindo que o √≥leo passe pelo radiador", "abre-se, permitindo que o √≥leo contorne radiador", "fecha-se, permitindo que o √≥leo passe pelo radiador", "fecha-se, permitindo que o √≥leo contorne radiador"], c: 3},
{q: "No sistema de lubrifica√ß√£o do motor, a v√°lvula de corte da parede de fogo dever√° estar na posi√ß√£o aberta", a: ["ocorrer fogo no motor", "o motor estiver funcionando normalmente", "for necess√°rio drenar o √≥leo para manuten√ß√£o", "a tubula√ß√£o, na linha de fornecimento, se romper e o √≥leo vazar"], c: 3},
{q: "No sistema de lubrifica√ß√£o do motor, a v√°lvula de al√≠vio localizada na sa√≠da da bomba principal limita a press√£o m√°xima do sistema, desviando o √≥leo para o reservat√≥rio ou para o (a):", a: ["dreno", "entrada da bomba principal", "sa√≠da do radiador", "interior do filtro"], c: 1},
{q: "No sistema de lubrifica√ß√£o, a v√°lvula by-pass instalada paralelamente ao filtro abrir-se-√°, no caso:", a: ["de ocorrer pane na bomba principal", "do √≥leo superaqueer", "do filtro entupir", "de faltar √≥leo na linha de press√£o"], c: 2},
{q: "No sistema de lubrifica√ß√£o, a v√°lvula que permite que o √≥leo seja desviado para o motor, em caso de filtro entupido, est√° localizada:", a: ["ap√≥s o filtro", "no interior do filtro", "na entrada do radiador", "ap√≥s a bomba, paralela ao filtro"], c: 3},
{q: "No sistema de refrigera√ß√£o do motor, a finalidade do termostato flutuante do controle de fluxo de ar atrav√©s do radiador √©:", a: ["manter automaticamente a temperatura normal do √≥leo", "assegurar a quantidade m√°xima de √≥leo, necess√°ria ao funcionamento do sistema", "controlar automaticamente a press√£o do √≥leo", "assegurar a quantidade m√≠nima de √≥leo, necess√°ria ao funcionamento do motor"], c: 0},
{q: "Num √≥leo do tipo SAE 20W a especifica√ß√£o de uso em clima frio √© determinado pelo:", a: ["E", "W", "20", "SAE"], c: 1},
{q: "O √≥leo lubrificante de um motor que \"n√£o\" possui reservat√≥rio, √© armazenado no:", a: ["filtro", "c√°rter", "cilindro", "radiador"], c: 1},
{q: "O componente do sistema de lubrifica√ß√£o que retira o √≥leo que circulou no motor e retorna-o para o reservat√≥rio √© a:", a: ["v√°lvula by-pass", "bomba de suc√ß√£o", "bomba de press√£o", "v√°lvula de al√≠vio de press√£o do √≥leo"], c: 1},
{q: "O componente do sistema de lubrifica√ß√£o que tem a finalidade de limitar a press√£o de √≥leo denomina-se:", a: ["filtro", "radiador", "v√°lvula de alivio", "v√°lvula de controle de fluxo"], c: 2},
{q: "O componente que tem a finalidade de limitar a press√£o de √≥leo do sistema de lubrifica√ß√£o denomina-se:", a: ["v√°lvula de alivio", "bomba", "radiador", "v√°lvula termost√°tica"], c: 0},
{q: "O componente que tem a finalidade de limitar a press√£o de √≥leo do sistema de lubrifica√ß√£o, denomina-se:", a: ["bomba", "radiador", "v√°lvula de alivio", "v√°lvula termost√°tica"], c: 2},
{q: "O controle de temperatura do √≥leo, pela varia√ß√£o do fluxo de √≥leo que passa pelo radiador, √© realizado atrav√©s de um(a):", a: ["ventoinha", "v√°lvula termost√°tica", "arruela de press√£o", "bomba"], c: 1},
{q: "O filtro do √≥leo, descart√°vel, usa como elemento filtrante:", a: ["tela met√°lica", "disco met√°lico", "l√¢mina de papel", "malha fina de a√ßo inoxid√°vel"], c: 2},
{q: "O indicador da press√£o de √≥leo utiliza como elemento sens√≠vel o(a):", a: ["diafragma", "tubo de bourdon", "c√°psula aneroid", "c√°psula diferencial"], c: 1},
{q: "O n√≠vel do reservat√≥rio de √≥leo deve ser checado:", a: ["com o motor em marcha lenta", "algum tempo ap√≥s o corte do motor", "imediatamente ap√≥s o corte do motor", "com o motor em regime de pot√™ncia m√°xima"], c: 1},
{q: "O n√≠vel do reservat√≥rio de √≥leo do motor deve ser verificado:", a: ["com motor em marcha lenta", "imediatamente ap√≥s o corte do motor", "no tempo pr√©-determinado pelo fabricante", "com  motor em regime de pot√™ncia m√°xima"], c: 2},
{q: "O n√∫cleo do radiador de √≥leo √© constru√≠do com tubos de cobre ou alum√≠nio, num formato que aparenta um (a):", a: ["teia", "disco", "colm√©ia", "pinheiro"], c: 2},
{q: "O recurso que o sistema utiliza para garantir a lubrifica√ß√£o do motor, caso o filtro esteja entupido √© o (a):", a: ["alarme sonoro", "√≥leo sint√©tico", "v√°lvula do tipo by-pass", "√≥leo com baixa viscosidade"], c: 2},
{q: "O sistema de lubrifica√ß√£o √© protegido contra uma press√£o excessiva que possa causar vazamentos no sistema, atrav√©s do componente denominado:", a: ["filtro", "radiador", "v√°lvula de alivio", "v√°lvula de controle de fluxo"], c: 2},
{q: "O sistema de lubrifica√ß√£o do motor a jato utiliza bomba do tipo:", a: ["pist√£o", "palheta", "centr√≠fuga", "engrenagem"], c: 3},
{q: "O sistema de lubrifica√ß√£o do motor emprega bomba de retorno, que opera por:", a: ["suc√ß√£o", "gravidade", "alta press√£o", "baixa press√£o"], c: 0},
{q: "Os rolamentos dos motores a rea√ß√£o s√£o lubrificados por:", a: ["n√©voa", "imers√£o", "press√£o", "salpique"], c: 2},
{q: "Os tanques de √≥leo das aeronaves nunca devem ser enchidos at√© sua capacidade m√°xima, em fun√ß√£o da:", a: ["viscosidade do √≥leo", "expans√£o t√©rmica do √≥leo", "forma√ß√£odo cal√ßo hidr√°ulico", "forma√ß√£o de vapores explosivos"], c: 1},
{q: "Para melhorar o arrefecimento do cilindro seria necess√°rio:", a: ["revisar o radiador", "substituir o combust√≠vel", "aumentar a viscodidade do √≥leo", "adicionar aletas ao cilindro"], c: 3},
{q: "Para se evitar que o √≥leo espume e entre ar na bomba, no reservat√≥rio hidr√°ulico, s√£o incorporados(as):", a: ["suspiros", "retentores", "aletas defletoras", "v√°lvulas de alivio"], c: 2},
{q: "Para uma opera√ß√£o segura ap√≥s a instala√ß√£o de um motor convencional, deve-se sangrar o combust√≠vel pelo", a: ["0,5 gal√£o", "1 gal√£o", "0,5 litro", "1 litro"], c: 1},
{q: "Quanto a bomba de press√£o de √≥leo do sistema de lubrifica√ß√£o √© correto afirmar que a mesma possui:", a: ["uma √∫nica engrenagem", "duas engrenagens que giram no mesmo sentido", "duas engrenagens que giram em sentido inverso", "um engrenagem que gira no sentido hor√°rio e duas outras que giram no anti-hor√°rio"], c: 2},
{q: "Quem devolve ao reservat√≥rio atrav√©s do radiador, o √≥leo proveniente de vazamentos internos?", a: ["v√°lvula de dreno", "v√°lvula de desvio", "bomba de recalque", "bomba de recupera√ß√£o"], c: 3},
{q: "Reduzir a temperatura do √≥leo do motor, a um valor aceit√°vel para a recircula√ß√£o atrav√©s do sistema de lubrifica√ß√£o √© finalidade do(a):", a: ["filtro", "radiador", "v√°lvula by-pass", "v√°lvula termoest√°tica"], c: 1},
{q: "Se durante o funcionamento normal do motor \"n√£o\" ocorrer entupimento no filtro de √≥leo a:", a: ["press√£o do sistema aumentar√°", "press√£o do sistema diminuir√°", "v√°lvula by-pass abrir-se-√°", "v√°lvula by-pass permanecer√° fechada"], c: 3},
{q: "Se pequenas part√≠culas met√°licas forem encontradas no √≥leo de um motor convencional, o procedimento a ser adotado √©:", a: ["girar o motor", "substituir o motor", "drenar e substituir todo o √≥leo", "apenas trocar o elemento filtrante"], c: 2},
{q: "Um √≥leo com alta temperatura, fluindo rapidamente, est√° com caracter√≠stica de:", a: ["alta viscosidade", "alta volatilidade", "baixa viscosidade", "baixa volatilidade"], c: 2},
{q: "Um √≥leo fluindo lentamente est√° com a caracter√≠stica de:", a: ["alta viscosidade", "baixa viscosidade", "alta volatilidade", "baixa volatilidade"], c: 0},
{q: "Um √≥leo que flui livremente quando exposto a alta temperatura tem como caracter√≠stica:", a: ["alta viscosidade", "baixa viscosidade", "alta volatilidade", "baixa volatilidade"], c: 1},
{q: "Uma das finalidades do √≥leo que √© distribu√≠do entre a parede do cilindro e o pist√£o √©:", a: ["diminuir a taxa de compress√£o", "aumentar o desgate abrasivo do pist√£o", "evitar o vazamento dos gases da c√¢mara", "lubrificar as v√°lvulas de admiss√£o e escapamento"], c: 2},
{q: "Uma indica√ß√£o de alta temperatura do √≥leo pode ser causada por uma pane no (a):", a: ["v√°lvula by-pass", "bomba de suc√ß√£o", "v√°lvula de al√≠vio", "bomba de retorno do √≥leo"], c: 3},
{q: "Uma press√£o de √≥leo excessivamente alta poder√° ocasionar ao motor:", a: ["vazamento", "baixa temperatura", "falta de lubrifica√ß√£o", "danos de caixa de redu√ß√£o"], c: 0},

];

    // ============================================
    // CONFIGURA√á√ïES DO SISTEMA
    // ============================================
    const QUESTIONS_PER_SIMULADO = 20;
    const API_URL = "https://script.google.com/macros/s/AKfycbwcX8bNdrDQZ6sRB1sbG0COJe7aGYyBlOCPkno2JxbM-59_-FsWt4LCccUQ8DBLTy1S5g/exec"; // URL do Google Apps Script
    const EMAIL_DESTINO = "ewerton.andriel@hotmail.com";
    
    let TIME_LIMIT = 0;
    let currentQuestions = [];
    let userAnswers = [];
    let timeLeft = 0;
    let timerId;
    let currentQuestionIndex = 0;
    let autoNavEnabled = true;
    let usedQuestionsHistory = [];
    let currentSimuladoIndices = [];
    
    // VARI√ÅVEIS DO SISTEMA DE REPORTE
    let currentReportQuestionIndex = null;
    let reportsHistory = [];

    // TIPOS DE REPORTE
    const REPORT_TYPES = {
        error: "‚ùå Quest√£o com erro",
        wrong_answer: "‚ö†Ô∏è Resposta incorreta", 
        confusing: "ü§î Enunciado confuso",
        alternative: "üî§ Alternativas erradas",
        other: "üìù Outro problema"
    };
    
    // ============================================
    // FUN√á√ïES PRINCIPAIS
    // ============================================
    
    // GERAR ID √öNICO AUTOMATICAMENTE
    function generateQuizId() {
        const pageTitle = document.title || "Quiz";
        const cleanTitle = pageTitle
            .replace(/[^a-zA-Z0-9\s]/g, '')
            .replace(/\s+/g, '_')
            .toLowerCase()
            .substring(0, 30);
        const titleHash = pageTitle.length.toString(36);
        return `quiz_${cleanTitle}_${titleHash}`;
    }
    
    const QUIZ_ID = generateQuizId();
    const HISTORY_KEY = `${QUIZ_ID}_history`;
    const REPORTS_KEY = `${QUIZ_ID}_reports`;

    // FUN√á√ÉO PARA ATUALIZAR T√çTULO DA P√ÅGINA
    function updatePageTitle() {
        const totalQuestions = masterBank.length;
        const remaining = Math.max(0, totalQuestions - usedQuestionsHistory.length);
        const isFinaleira = currentQuestions.length < QUESTIONS_PER_SIMULADO && remaining < QUESTIONS_PER_SIMULADO;
        const finaleiraText = isFinaleira ? ' üî• FINALEIRA' : '';
        
        // Pega o t√≠tulo da p√°gina HTML
        const pageTitle = document.title || "Quiz Simulado";
        
        // Limpa prefixos/sufixos comuns
        let cleanTitle = pageTitle
            .replace(/^GMP\s*[-‚Äì‚Äî]\s*/i, '')
            .replace(/^Simulado\s*[-‚Äì‚Äî]\s*/i, '')
            .replace(/^Quiz\s*[-‚Äì‚Äî]\s*/i, '')
            .replace(/\s*[-‚Äì‚Äî]\s*Simulado$/i, '')
            .replace(/\s*[-‚Äì‚Äî]\s*Quiz$/i, '')
            .replace(/\s*[-‚Äì‚Äî]\s*Teste$/i, '')
            .trim();
        
        // Se ficou vazio, usa o t√≠tulo original
        if (!cleanTitle) cleanTitle = pageTitle;
        
        // Garante que n√£o seja muito longo
        if (cleanTitle.length > 40) {
            cleanTitle = cleanTitle.substring(0, 37) + '...';
        }
        
        // Formata o t√≠tulo final
        document.getElementById('page-title').textContent = 
            `${cleanTitle}${finaleiraText} (${currentQuestions.length}/${totalQuestions})`;
        
        return isFinaleira;
    }

    function calculateTimeLimit(questionsCount) {
        return questionsCount * 60;
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // L√≥gica inteligente para sele√ß√£o de quest√µes
    function selectRandomQuestions() {
        const totalQuestions = masterBank.length;
        
        // Verifica se o banco est√° vazio
        if (totalQuestions === 0) {
            alert("‚ö†Ô∏è O banco de quest√µes est√° vazio! Adicione quest√µes no c√≥digo.");
            return [];
        }
        
        let availableQuestions = [];
        
        // Todas as quest√µes dispon√≠veis
        for (let i = 0; i < totalQuestions; i++) {
            availableQuestions.push(i);
        }
        
        // Remove as j√° usadas (do hist√≥rico persistente)
        if (usedQuestionsHistory.length > 0) {
            availableQuestions = availableQuestions.filter(index => 
                !usedQuestionsHistory.includes(index)
            );
        }
        
        const availableCount = availableQuestions.length;
        
        // DECIS√ÉO INTELIGENTE: quantas quest√µes usar?
        let questionsToSelect;
        
        if (availableCount === 0) {
            // Se n√£o tem mais quest√µes dispon√≠veis
            if (confirm(`Todas as ${totalQuestions} quest√µes j√° foram usadas!\n\nDeseja reiniciar o hist√≥rico e come√ßar de novo?`)) {
                usedQuestionsHistory = [];
                localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
                availableQuestions = Array.from({length: totalQuestions}, (_, i) => i);
                questionsToSelect = Math.min(QUESTIONS_PER_SIMULADO, totalQuestions);
                alert('Hist√≥rico reiniciado! Todas as quest√µes est√£o dispon√≠veis novamente.');
            } else {
                // Usa todas as quest√µes mesmo (modo de repeti√ß√£o)
                availableQuestions = Array.from({length: totalQuestions}, (_, i) => i);
                questionsToSelect = Math.min(QUESTIONS_PER_SIMULADO, totalQuestions);
            }
        } 
        else if (availableCount >= QUESTIONS_PER_SIMULADO) {
            // Tem quest√µes suficientes para um simulado normal
            questionsToSelect = QUESTIONS_PER_SIMULADO;
        }
        else if (availableCount >= 10) {
            // Tem entre 10 e 19 quest√µes - usa todas dispon√≠veis
            questionsToSelect = availableCount;
        }
        else {
            // Tem menos de 10 quest√µes - oferece op√ß√£o de "finaleira"
            if (confirm(`S√≥ restam ${availableCount} quest√µes dispon√≠veis!\n\nDeseja fazer uma "finaleira" com essas ${availableCount} quest√µes restantes?`)) {
                questionsToSelect = availableCount;
            } else {
                // Usu√°rio n√£o quer fazer finaleira, reinicia hist√≥rico
                if (confirm(`Deseja reiniciar o hist√≥rico e come√ßar um novo ciclo com todas as ${totalQuestions} quest√µes?`)) {
                    usedQuestionsHistory = [];
                    localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
                    availableQuestions = Array.from({length: totalQuestions}, (_, i) => i);
                    questionsToSelect = Math.min(QUESTIONS_PER_SIMULADO, totalQuestions);
                    alert('Hist√≥rico reiniciado!');
                } else {
                    // Continua com as dispon√≠veis mesmo sendo poucas
                    questionsToSelect = availableCount;
                }
            }
        }
        
        // Embaralha as quest√µes dispon√≠veis
        availableQuestions.sort(() => Math.random() - 0.5);
        
        // Seleciona as quest√µes
        const selectedIndices = availableQuestions.slice(0, questionsToSelect);
        
        // Armazena temporariamente (n√£o salva no localStorage ainda)
        currentSimuladoIndices = selectedIndices;
        
        return selectedIndices.map(index => ({
            ...masterBank[index], 
            originalIndex: index
        }));
    }

    function updateSimuladoInfo() {
        const totalQuestions = masterBank.length;
        const remaining = Math.max(0, totalQuestions - usedQuestionsHistory.length);
        const recentUsed = usedQuestionsHistory.length;
        const percentUsed = totalQuestions > 0 ? Math.round((recentUsed / totalQuestions) * 100) : 0;
        
        // Verifica se √© finaleira
        const isFinaleira = currentQuestions.length < QUESTIONS_PER_SIMULADO && remaining < QUESTIONS_PER_SIMULADO;
        
        // Atualiza elementos
        if (document.getElementById('remaining-questions')) {
            document.getElementById('remaining-questions').textContent = `Dispon√≠veis: ${remaining}`;
            document.getElementById('recent-used').textContent = `Usadas: ${recentUsed}`;
            document.getElementById('questions-per-simulado').textContent = currentQuestions.length;
        }
        
        // Adiciona informa√ß√£o sobre o tamanho do simulado atual
        const simuladoInfo = document.getElementById('simulado-info');
        if (simuladoInfo) {
            simuladoInfo.innerHTML = `
                <div>Simulado: <span id="questions-per-simulado">${currentQuestions.length}</span> quest√µes 
                <span style="font-size: 0.6rem; color: ${isFinaleira ? 'var(--warning)' : 'var(--primary)'}">
                    ${isFinaleira ? '(finaleira)' : ''}
                </span></div>
                <div class="simulado-stats">
                    <span id="remaining-questions">Dispon√≠veis: ${remaining}</span>
                    <span id="recent-used">Usadas: ${recentUsed} (${percentUsed}%)</span>
                </div>
                
                <div class="history-controls">
                    <button class="clear-history-btn" onclick="clearHistory()">üóëÔ∏è Limpar Hist√≥rico</button>
                    <button class="info-history-btn" onclick="showHistoryInfo()">‚ÑπÔ∏è Info</button>
                </div>
            `;
            
            simuladoInfo.style.display = 'block';
        }
    }

    function clearHistory() {
        if (confirm(`Limpar hist√≥rico deste simulado? Todas as ${masterBank.length} quest√µes ficar√£o dispon√≠veis novamente.`)) {
            // Limpa hist√≥rico
            usedQuestionsHistory = [];
            localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
            
            // RESETA A INTERFACE PARA MODO DE SIMULADO ATIVO
            document.getElementById('results').style.display = 'none';
            document.getElementById('finish-btn').style.display = 'block';
            document.getElementById('restart-btn').style.display = 'none';
            document.getElementById('new-simulado-btn').style.display = 'none';
            document.querySelector('.nav-buttons').style.display = 'flex';
            
            // Gera novo simulado
            currentQuestions = selectRandomQuestions();
            
            // Verifica se tem quest√µes
            if (currentQuestions.length === 0) {
                alert("N√£o foi poss√≠vel gerar o simulado. Verifique se h√° quest√µes no banco.");
                return;
            }
            
            userAnswers = new Array(currentQuestions.length).fill(null);
            currentQuestionIndex = 0;
            TIME_LIMIT = calculateTimeLimit(currentQuestions.length);
            timeLeft = TIME_LIMIT;
            
            // Atualiza interface
            updatePageTitle();
            document.getElementById('timer').textContent = formatTime(timeLeft);
            updateSimuladoInfo();
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
            updateFinishButton();
            updatePendingQuestions();
            
            // Inicia timer
            startTimer();
            
            alert('Hist√≥rico limpo! Novo simulado gerado.');
        }
    }

    function showHistoryInfo() {
        const totalQuestions = masterBank.length;
        const usedCount = usedQuestionsHistory.length;
        const availableCount = Math.max(0, totalQuestions - usedCount);
        const percentUsed = totalQuestions > 0 ? Math.round((usedCount / totalQuestions) * 100) : 0;
        
        let message = `üìä ESTAT√çSTICAS:\n\n`;
        message += `‚Ä¢ Total no banco: ${totalQuestions} quest√µes\n`;
        message += `‚Ä¢ J√° usadas: ${usedCount} (${percentUsed}%)\n`;
        message += `‚Ä¢ Dispon√≠veis: ${availableCount}\n`;
        message += `‚Ä¢ Tamanho padr√£o: ${QUESTIONS_PER_SIMULADO} quest√µes\n\n`;
        
        if (currentSimuladoIndices.length > 0) {
            const isFinaleira = currentQuestions.length < QUESTIONS_PER_SIMULADO && availableCount < QUESTIONS_PER_SIMULADO;
            message += `üìù SIMULADO ATUAL:\n`;
            message += `‚Ä¢ ${currentSimuladoIndices.length} quest√µes\n`;
            if (isFinaleira) {
                message += `‚Ä¢ üî• FINALEIRA (quest√µes restantes)\n`;
            }
            message += `‚Ä¢ Ser√° salvo ao FINALIZAR\n\n`;
        }
        
        if (availableCount < QUESTIONS_PER_SIMULADO && availableCount > 0) {
            message += `‚ö†Ô∏è  ATEN√á√ÉO: S√≥ restam ${availableCount} quest√µes!\n`;
            message += `O pr√≥ximo simulado ser√° uma "finaleira" com as quest√µes restantes.`;
        } else if (availableCount === 0) {
            message += `üéØ CONCLU√çDO: Todas as quest√µes j√° foram usadas!\n`;
            message += `Clique em "Limpar Hist√≥rico" para recome√ßar.`;
        }
        
        alert(message);
    }

    function updatePendingQuestions() {
        const pendingList = document.getElementById('pending-list');
        const pendingCount = document.getElementById('pending-count');
        const answeredCount = getAnsweredCount();
        const pending = currentQuestions.length - answeredCount;
        
        if (pendingCount) pendingCount.textContent = pending;
        
        if (pending === 0) {
            if (pendingList) pendingList.innerHTML = '<span style="color: #28a745;">‚úÖ Todas</span>';
            return;
        }
        
        let html = '';
        let pendingNumbers = [];
        
        for (let i = 0; i < currentQuestions.length; i++) {
            if (userAnswers[i] === null) {
                pendingNumbers.push(i + 1);
            }
        }
        
        const maxToShow = 15;
        const numbersToShow = pendingNumbers.slice(0, maxToShow);
        
        numbersToShow.forEach(num => {
            html += `<span class="pending-number">${num}</span>`;
        });
        
        if (pendingNumbers.length > maxToShow) {
            html += `<span style="color: #6c757d; font-size: 0.55rem;"> +${pendingNumbers.length - maxToShow}</span>`;
        }
        
        if (pendingList) {
            pendingList.innerHTML = html || '<span style="color: #6c757d;">Nenhuma</span>';
        }
    }

    function initQuiz() {
        // Verifica se h√° quest√µes no banco
        if (masterBank.length === 0) {
            document.getElementById('page-title').textContent = "‚ö†Ô∏è BANCO VAZIO";
            document.getElementById('quiz-content').innerHTML = `
                <div class="question-block-mini">
                    <div class="question-text-mini" style="color: var(--danger);">
                        ‚ö†Ô∏è ERRO: Banco de quest√µes vazio!
                    </div>
                    <div style="font-size: 0.7rem; color: #6c757d; margin-top: 10px;">
                        <p>Adicione quest√µes no c√≥digo JavaScript:</p>
                        <ol style="text-align: left; padding-left: 20px;">
                            <li>Abra o arquivo HTML em um editor de texto</li>
                            <li>Encontre a se√ß√£o "COLE SUAS QUEST√ïES AQUI"</li>
                            <li>Cole suas quest√µes no formato correto</li>
                            <li>Salve e recarregue a p√°gina</li>
                        </ol>
                        <p style="margin-top: 10px; font-weight: bold;">
                            Formato: {q: "Pergunta?", a: ["A", "B", "C", "D"], c: 0}
                        </p>
                    </div>
                </div>
            `;
            return;
        }
        
        // Carrega hist√≥rico existente
        const savedHistory = localStorage.getItem(HISTORY_KEY);
        if (savedHistory) {
            usedQuestionsHistory = JSON.parse(savedHistory);
        } else {
            usedQuestionsHistory = [];
        }
        
        // Seleciona quest√µes com l√≥gica inteligente
        currentQuestions = selectRandomQuestions();
        
        // Verifica se conseguiu selecionar quest√µes
        if (currentQuestions.length === 0) {
            alert("N√£o foi poss√≠vel selecionar quest√µes. Verifique o banco de dados.");
            return;
        }
        
        TIME_LIMIT = calculateTimeLimit(currentQuestions.length);
        
        // Atualiza t√≠tulo (mostra "finaleira" se for o caso)
        updatePageTitle();
        
        userAnswers = new Array(currentQuestions.length).fill(null);
        timeLeft = TIME_LIMIT;
        currentQuestionIndex = 0;
        autoNavEnabled = true;
        
        document.getElementById('timer').textContent = formatTime(timeLeft);
        document.getElementById('auto-nav-checkbox').checked = true;
        
        updateSimuladoInfo();
        startTimer();
        renderCurrentQuestion();
        updateCounters();
        updateNavButtons();
        updateFinishButton();
        updatePendingQuestions();
    }

    function generateNewSimulado() {
        const totalAvailable = Math.max(0, masterBank.length - usedQuestionsHistory.length);
        
        let message;
        if (totalAvailable === 0) {
            message = `Todas as ${masterBank.length} quest√µes j√° foram usadas!\n\nDeseja reiniciar o hist√≥rico e gerar novo simulado?`;
        } else if (totalAvailable < QUESTIONS_PER_SIMULADO) {
            message = `S√≥ restam ${totalAvailable} quest√µes dispon√≠veis.\n\nDeseja fazer um simulado com essas ${totalAvailable} quest√µes restantes?`;
        } else {
            message = `Gerar novo simulado com ${Math.min(QUESTIONS_PER_SIMULADO, totalAvailable)} quest√µes?`;
        }
        
        if (confirm(message)) {
            if (totalAvailable === 0) {
                // Reinicia hist√≥rico se n√£o tem mais quest√µes
                usedQuestionsHistory = [];
                localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
                alert('Hist√≥rico reiniciado! Todas as quest√µes est√£o dispon√≠veis.');
            }
            
            // RESETA A INTERFACE
            document.getElementById('results').style.display = 'none';
            document.getElementById('finish-btn').style.display = 'block';
            document.getElementById('restart-btn').style.display = 'none';
            document.getElementById('new-simulado-btn').style.display = 'none';
            document.querySelector('.nav-buttons').style.display = 'flex';
            
            // Seleciona novas quest√µes
            currentQuestions = selectRandomQuestions();
            
            if (currentQuestions.length === 0) {
                alert("Erro ao gerar novo simulado.");
                return;
            }
            
            TIME_LIMIT = calculateTimeLimit(currentQuestions.length);
            userAnswers = new Array(currentQuestions.length).fill(null);
            timeLeft = TIME_LIMIT;
            currentQuestionIndex = 0;
            
            // Atualiza t√≠tulo
            updatePageTitle();
            
            document.getElementById('timer').textContent = formatTime(timeLeft);
            startTimer();
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
            updateFinishButton();
            updatePendingQuestions();
            updateSimuladoInfo();
        }
    }

    function renderCurrentQuestion() {
        const container = document.getElementById('quiz-content');
        
        if (!currentQuestions || currentQuestions.length === 0) {
            container.innerHTML = '<div class="question-block-mini">Erro: Nenhuma quest√£o carregada.</div>';
            return;
        }
        
        const question = currentQuestions[currentQuestionIndex];
        
        container.innerHTML = `
            <div class="question-block-mini">
                <div class="question-text-mini">
                    ${currentQuestionIndex + 1}. ${question.q}
                </div>
                <div class="options-mini">
                    ${question.a.map((opt, i) => `
                        <label class="option-mini" id="option-${i}">
                            <input type="radio" name="currentQuestion" value="${i}" 
                                   ${userAnswers[currentQuestionIndex] === i ? 'checked' : ''}
                                   onchange="selectAnswer(${i})">
                            ${opt}
                        </label>
                    `).join('')}
                </div>
                <!-- BOT√ÉO DE REPORTAR (DURANTE O SIMULADO) -->
                <button class="report-btn" onclick="openReportModal(${currentQuestionIndex})">
                    <span>‚ö†Ô∏è</span> Reportar Problema
                </button>
            </div>
        `;
    }

    function selectAnswer(answerIndex) {
        userAnswers[currentQuestionIndex] = answerIndex;
        updateCounters();
        updateFinishButton();
        updatePendingQuestions();
        
        if (autoNavEnabled && currentQuestionIndex < currentQuestions.length - 1) {
            setTimeout(() => {
                nextQuestion();
            }, 200);
        }
    }

    function toggleAutoNav() {
        autoNavEnabled = !autoNavEnabled;
        document.getElementById('auto-nav-checkbox').checked = autoNavEnabled;
    }

    function getAnsweredCount() {
        return userAnswers.filter(answer => answer !== null).length;
    }

    function updateFinishButton() {
        const finishBtn = document.getElementById('finish-btn');
        const answeredCount = getAnsweredCount();
        const allAnswered = answeredCount === currentQuestions.length;
        
        finishBtn.disabled = !allAnswered;
        finishBtn.innerHTML = allAnswered ? 'üèÅ Finalizar' : `‚ùå Faltam ${currentQuestions.length - answeredCount}`;
    }

    function updateNavButtons() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        
        prevBtn.disabled = currentQuestionIndex === 0;
        nextBtn.disabled = currentQuestionIndex === currentQuestions.length - 1;
        nextBtn.innerHTML = currentQuestionIndex === currentQuestions.length - 1 ? '√öltima' : 'Pr√≥ximo ‚Üí';
    }

    function updateCounters() {
        const answeredCount = getAnsweredCount();
        
        document.getElementById('question-counter').textContent = `${currentQuestionIndex + 1}/${currentQuestions.length}`;
        document.getElementById('answered-counter').textContent = `${answeredCount}/${currentQuestions.length}`;
        document.getElementById('progress-percent').textContent = `${currentQuestions.length > 0 ? Math.round((answeredCount / currentQuestions.length) * 100) : 0}%`;
        document.getElementById('status-count').textContent = `${answeredCount}/${currentQuestions.length}`;
        
        updateTimerDisplay();
    }

    function updateTimerDisplay() {
        const timerElement = document.getElementById('timer');
        timerElement.textContent = formatTime(timeLeft);
        
        if (timeLeft <= Math.min(300, Math.floor(TIME_LIMIT * 0.25))) {
            timerElement.classList.add('timer-warning');
        } else {
            timerElement.classList.remove('timer-warning');
        }
    }

    function startTimer() {
        clearInterval(timerId);
        
        timerId = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(timerId);
                if (getAnsweredCount() === currentQuestions.length) {
                    finalizeQuiz();
                } else {
                    if (confirm('Tempo esgotado! Deseja finalizar o simulado?')) {
                        finalizeQuiz();
                    }
                }
            }
        }, 1000);
    }

    function nextQuestion() {
        if (currentQuestionIndex < currentQuestions.length - 1) {
            currentQuestionIndex++;
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
        }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
        }
    }

    function finalizeQuiz() {
        clearInterval(timerId);
        
        const answeredCount = getAnsweredCount();
        if (answeredCount !== currentQuestions.length && !confirm(`Respondidas: ${answeredCount}/${currentQuestions.length}. Finalizar?`)) {
            startTimer();
            return;
        }
        
        let finalScore = 0;
        userAnswers.forEach((answer, index) => {
            if (answer !== null && answer === currentQuestions[index].c) {
                finalScore++;
            }
        });
        
        const percent = currentQuestions.length > 0 ? Math.round((finalScore / currentQuestions.length) * 100) : 0;
        const feedback = document.getElementById('feedback-msg');
        
        if (percent >= 70) feedback.textContent = "üéâ Aprovado!";
        else if (percent >= 50) feedback.textContent = "üëç Quase l√°!";
        else feedback.textContent = "üí™ Continue!";
        
        feedback.style.color = percent >= 70 ? "var(--success)" : percent >= 50 ? "var(--accent)" : "var(--danger)";
        
        // Adiciona ao hist√≥rico persistente (SEM LIMITE)
        if (currentSimuladoIndices.length > 0) {
            usedQuestionsHistory.push(...currentSimuladoIndices);
            
            // Remove duplicatas (apenas para limpeza)
            usedQuestionsHistory = [...new Set(usedQuestionsHistory)];
            
            // SALVA NO localStorage SEM LIMITE
            localStorage.setItem(HISTORY_KEY, JSON.stringify(usedQuestionsHistory));
        }
        
        // Mostra quest√µes com cores E BOT√ÉO DE REPORTAR NO GABARITO
        let quizHTML = '';
        currentQuestions.forEach((question, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === question.c;
            
            quizHTML += `
                <div class="question-block-mini">
                    <!-- BOT√ÉO DE REPORTAR NO GABARITO (canto superior direito) -->
                    <button class="report-gabarito-btn" onclick="openReportModal(${index})" title="Reportar problema nesta quest√£o">
                        ‚ö†Ô∏è
                    </button>
                    
                    <div class="question-text-mini">
                        ${index + 1}. ${question.q}
                    </div>
                    <div class="options-mini">
                        ${question.a.map((opt, i) => {
                            let classes = 'option-mini';
                            if (i === question.c) classes += ' correct-answer';
                            else if (userAnswer === i && !isCorrect) classes += ' wrong-answer';
                            
                            return `<label class="${classes}">
                                <input type="radio" disabled ${userAnswer === i ? 'checked' : ''}>
                                ${opt}
                                ${userAnswer === i ? '<span style="margin-left: auto; font-size: 0.6rem; color: #6c757d;">(sua resposta)</span>' : ''}
                                ${i === question.c && userAnswer !== i ? '<span style="margin-left: auto; font-size: 0.6rem; color: var(--success);">(correta)</span>' : ''}
                            </label>`;
                        }).join('')}
                    </div>
                </div>
            `;
        });
        
        document.getElementById('quiz-content').innerHTML = quizHTML;
        document.getElementById('final-score').textContent = `${finalScore}/${currentQuestions.length}`;
        document.getElementById('final-percent').textContent = `${percent}%`;
        
        const totalQuestions = masterBank.length;
        const remainingQuestions = Math.max(0, totalQuestions - usedQuestionsHistory.length);
        const percentComplete = totalQuestions > 0 ? Math.round((usedQuestionsHistory.length / totalQuestions) * 100) : 0;
        
        let summaryText = '';
        if (remainingQuestions === 0) {
            summaryText = `üéØ PARAB√âNS! Voc√™ completou TODAS as ${totalQuestions} quest√µes!`;
        } else if (remainingQuestions < QUESTIONS_PER_SIMULADO) {
            summaryText = `üî• Restam apenas ${remainingQuestions} quest√µes para a finaleira!<br>Progresso total: ${percentComplete}%`;
        } else {
            summaryText = `Quest√µes deste simulado foram adicionadas ao hist√≥rico.<br>Restantes: <strong>${remainingQuestions}</strong> | Total usadas: <strong>${usedQuestionsHistory.length}</strong> (${percentComplete}%)`;
        }
        
        document.getElementById('simulado-summary').innerHTML = summaryText;
        
        // MOSTRA RESULTADOS E OCULTA CONTROLES DO SIMULADO
        document.querySelector('.nav-buttons').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        document.getElementById('finish-btn').style.display = 'none';
        document.getElementById('restart-btn').style.display = 'block';
        document.getElementById('new-simulado-btn').style.display = 'block';
        
        // Atualiza info do simulado
        updateSimuladoInfo();
    }

    function resetQuiz() {
        if (confirm('Reiniciar este simulado? Suas respostas ser√£o perdidas, mas as quest√µes N√ÉO ser√£o salvas no hist√≥rico.')) {
            userAnswers = new Array(currentQuestions.length).fill(null);
            timeLeft = TIME_LIMIT;
            currentQuestionIndex = 0;
            
            startTimer();
            renderCurrentQuestion();
            updateCounters();
            updateNavButtons();
            updateFinishButton();
            updatePendingQuestions();
        }
    }

    function startNewQuiz() {
        // RESETA A INTERFACE
        document.getElementById('results').style.display = 'none';
        document.getElementById('finish-btn').style.display = 'block';
        document.getElementById('restart-btn').style.display = 'none';
        document.getElementById('new-simulado-btn').style.display = 'none';
        document.querySelector('.nav-buttons').style.display = 'flex';
        
        // Usa as MESMAS quest√µes (n√£o gera novas)
        userAnswers = new Array(currentQuestions.length).fill(null);
        timeLeft = TIME_LIMIT;
        currentQuestionIndex = 0;
        
        startTimer();
        renderCurrentQuestion();
        updateCounters();
        updateNavButtons();
        updateFinishButton();
        updatePendingQuestions();
    }

    // ============================================
    // SISTEMA DE REPORTE AVAN√áADO
    // ============================================
    
    function initReportSystem() {
        // Carrega hist√≥rico de reportes
        const savedReports = localStorage.getItem(REPORTS_KEY);
        if (savedReports) {
            reportsHistory = JSON.parse(savedReports);
        } else {
            reportsHistory = [];
        }
        
        // Configura eventos do modal
        document.getElementById('cancelReport').onclick = closeReportModal;
        document.getElementById('submitReport').onclick = submitReport;
        
        // Fecha modal ao clicar fora
        document.getElementById('reportModal').onclick = function(e) {
            if (e.target.id === 'reportModal') {
                closeReportModal();
            }
        };
        
        // Contador de caracteres
        const reportDetails = document.getElementById('reportDetails');
        const charCount = document.getElementById('charCount');
        
        if (reportDetails && charCount) {
            reportDetails.addEventListener('input', function() {
                charCount.textContent = this.value.length;
                if (this.value.length > 1000) {
                    this.value = this.value.substring(0, 1000);
                    charCount.textContent = 1000;
                }
            });
        }
        
        // Limita formul√°rios
        const inputs = document.querySelectorAll('.form-input');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.classList.contains('error')) {
                    this.classList.remove('error');
                    hideError();
                }
            });
        });
    }

    function openReportModal(questionIndex) {
        currentReportQuestionIndex = questionIndex;
        
        // Verifica se h√° quest√µes carregadas
        if (!currentQuestions || currentQuestions.length === 0) {
            alert("N√£o h√° quest√µes carregadas.");
            return;
        }
        
        const question = currentQuestions[questionIndex];
        
        // Atualiza informa√ß√µes no modal
        document.getElementById('reportQuestionNumber').textContent = questionIndex + 1;
        
        // Trunca o texto da quest√£o se for muito longo
        let questionText = question.q;
        if (questionText.length > 150) {
            questionText = questionText.substring(0, 147) + '...';
        }
        document.getElementById('reportQuestionText').textContent = questionText;
        
        // Limpa formul√°rio anterior
        document.querySelectorAll('input[name="reportType"]').forEach(radio => {
            radio.checked = false;
        });
        document.getElementById('reportDetails').value = '';
        document.getElementById('userName').value = '';
        document.getElementById('userEmail').value = '';
        document.getElementById('userInfo').value = '';
        document.getElementById('charCount').textContent = '0';
        document.getElementById('reportSuccess').style.display = 'none';
        document.getElementById('reportErrorMsg').style.display = 'none';
        
        // Habilita bot√£o de submit
        document.getElementById('submitReport').disabled = false;
        document.getElementById('submitText').textContent = 'Enviar Reporte';
        document.getElementById('submitLoading').style.display = 'none';
        
        // Mostra modal
        document.getElementById('reportModal').style.display = 'flex';
        
        // Foca no primeiro campo
        setTimeout(() => {
            document.getElementById('userName').focus();
        }, 100);
    }

    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
        currentReportQuestionIndex = null;
    }

    function showError(message) {
        const errorElement = document.getElementById('reportErrorMsg');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
        
        // Rola at√© o erro
        errorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function hideError() {
        document.getElementById('reportErrorMsg').style.display = 'none';
    }

    function validateForm() {
        const name = document.getElementById('userName').value.trim();
        const email = document.getElementById('userEmail').value.trim();
        const reportType = document.querySelector('input[name="reportType"]:checked');
        
        // Valida campos obrigat√≥rios
        if (!name) {
            document.getElementById('userName').classList.add('error');
            showError('Por favor, preencha seu nome completo.');
            return false;
        }
        
        if (!email) {
            document.getElementById('userEmail').classList.add('error');
            showError('Por favor, preencha seu e-mail.');
            return false;
        }
        
        // Valida formato do email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            document.getElementById('userEmail').classList.add('error');
            showError('Por favor, insira um e-mail v√°lido.');
            return false;
        }
        
        if (!reportType) {
            showError('Por favor, selecione o tipo de problema.');
            return false;
        }
        
        return true;
    }

    // FUN√á√ÉO PARA ENVIAR REPORTE VIA GOOGLE APPS SCRIPT
    async function submitReport() {
        // Valida formul√°rio
        if (!validateForm()) {
            return;
        }
        
        const questionIndex = currentReportQuestionIndex;
        const question = currentQuestions[questionIndex];
        
        // Coleta dados do formul√°rio
        const reportData = {
            quizId: QUIZ_ID,
            materia: document.title || "Quiz",
            questionIndex: questionIndex + 1,
            originalIndex: question.originalIndex,
            questionText: question.q,
            reportType: document.querySelector('input[name="reportType"]:checked').value,
            reportLabel: REPORT_TYPES[document.querySelector('input[name="reportType"]:checked').value],
            details: document.getElementById('reportDetails').value.trim(),
            userName: document.getElementById('userName').value.trim(),
            userEmail: document.getElementById('userEmail').value.trim(),
            userInfo: document.getElementById('userInfo').value.trim(),
            userAnswer: userAnswers[questionIndex] !== null ? 
                question.a[userAnswers[questionIndex]] : 'N√£o respondida',
            correctAnswer: question.a[question.c],
            userAnswerIndex: userAnswers[questionIndex],
            correctAnswerIndex: question.c,
            timestamp: new Date().toLocaleString('pt-BR'),
            url: window.location.href,
            userAgent: navigator.userAgent
        };
        
        // Mostra estado de carregamento
        document.getElementById('submitReport').disabled = true;
        document.getElementById('submitText').textContent = 'Enviando...';
        document.getElementById('submitLoading').style.display = 'inline-block';
        
        try {
            // Tenta enviar via Google Apps Script
            const response = await sendToGoogleSheets(reportData);
            
            if (response.success) {
                // Adiciona ao hist√≥rico local
                const report = {
                    ...reportData,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    sentToGoogleSheets: true
                };
                
                reportsHistory.push(report);
                localStorage.setItem(REPORTS_KEY, JSON.stringify(reportsHistory));
                
                // Mostra mensagem de sucesso
                document.getElementById('reportSuccess').style.display = 'block';
                document.getElementById('submitText').textContent = 'Enviado!';
                
                // Fecha modal ap√≥s 3 segundos
                setTimeout(() => {
                    closeReportModal();
                }, 3000);
            } else {
                throw new Error(response.message || 'Erro ao enviar');
            }
        } catch (error) {
            console.error('Erro ao enviar reporte:', error);
            
            // Fallback: Envia por email se o Google Sheets falhar
            const emailSent = sendReportByEmailFallback(reportData);
            
            if (emailSent) {
                // Adiciona ao hist√≥rico local
                const report = {
                    ...reportData,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    sentByEmail: true
                };
                
                reportsHistory.push(report);
                localStorage.setItem(REPORTS_KEY, JSON.stringify(reportsHistory));
                
                document.getElementById('reportSuccess').innerHTML = 
                    '‚úÖ Reporte enviado por email! Obrigado pela contribui√ß√£o.<br>' +
                    '<small>Voc√™ receber√° um feedback por email em breve.</small>';
                document.getElementById('reportSuccess').style.display = 'block';
                document.getElementById('submitText').textContent = 'Enviado!';
                
                setTimeout(() => {
                    closeReportModal();
                }, 3000);
            } else {
                // Se ambos falharem, salva localmente
                const report = {
                    ...reportData,
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    savedLocally: true
                };
                
                reportsHistory.push(report);
                localStorage.setItem(REPORTS_KEY, JSON.stringify(reportsHistory));
                
                showError('Erro de conex√£o. Reporte salvo localmente. Tente novamente mais tarde.');
                document.getElementById('submitReport').disabled = false;
                document.getElementById('submitText').textContent = 'Enviar Reporte';
                document.getElementById('submitLoading').style.display = 'none';
            }
        }
    }

    // Fun√ß√£o para enviar para Google Sheets via Google Apps Script
    async function sendToGoogleSheets(reportData) {
        const formData = new FormData();
        
        // Adiciona todos os dados ao FormData
        Object.keys(reportData).forEach(key => {
            formData.append(key, reportData[key]);
        });
        
        // Envia para o Google Apps Script
        const response = await fetch(API_URL, {
            method: 'POST',
            body: formData,
            mode: 'no-cors' // Importante para evitar problemas de CORS
        });
        
        // Como estamos usando no-cors, n√£o podemos ler a resposta
        // Mas assumimos que foi bem-sucedido se n√£o houver erro de rede
        return { success: true, message: 'Enviado com sucesso' };
    }

    // Fallback: Envia por email se o Google Sheets falhar
    function sendReportByEmailFallback(reportData) {
        try {
            const subject = `[REPORTE] ${reportData.materia} - Quest√£o #${reportData.questionIndex}`;
            
            let body = `NOVO REPORTE DE QUEST√ÉO\n`;
            body += `=======================\n\n`;
            body += `MAT√âRIA: ${reportData.materia}\n`;
            body += `ID DO QUIZ: ${reportData.quizId}\n`;
            body += `QUEST√ÉO #${reportData.questionIndex}\n`;
            body += `√çNDICE ORIGINAL: ${reportData.originalIndex}\n\n`;
            body += `ENUNCIADO:\n${reportData.questionText}\n\n`;
            body += `TIPO DE PROBLEMA: ${reportData.reportLabel}\n\n`;
            body += `RESPOSTA DO USU√ÅRIO: ${reportData.userAnswer}\n`;
            body += `RESPOSTA CORRETA: ${reportData.correctAnswer}\n\n`;
            
            body += `INFORMA√á√ïES DO USU√ÅRIO:\n`;
            body += `Nome: ${reportData.userName}\n`;
            body += `E-mail: ${reportData.userEmail}\n`;
            body += `Institui√ß√£o/Curso: ${reportData.userInfo || 'N√£o informado'}\n\n`;
            
            if (reportData.details) {
                body += `DETALHES ADICIONAIS:\n${reportData.details}\n\n`;
            }
            
            body += `DATA/HORA: ${reportData.timestamp}\n`;
            body += `URL DA P√ÅGINA: ${reportData.url}\n`;
            
            // Codifica para URL
            const encodedSubject = encodeURIComponent(subject);
            const encodedBody = encodeURIComponent(body);
            
            // Cria link mailto:
            const mailtoLink = `mailto:${EMAIL_DESTINO}?subject=${encodedSubject}&body=${encodedBody}`;
            
            // Abre cliente de email
            window.open(mailtoLink, '_blank');
            return true;
        } catch (error) {
            console.error('Erro ao enviar email:', error);
            return false;
        }
    }

    // ============================================
    // INICIALIZA√á√ÉO
    // ============================================
    
    // Atalhos de teclado
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight' || e.key === ' ') nextQuestion();
        if (e.key === 'ArrowLeft') prevQuestion();
    });

    // Inicializar quando a p√°gina carregar
    window.onload = function() {
        initQuiz();
        initReportSystem();
    };
</script>

</body>
</html>
